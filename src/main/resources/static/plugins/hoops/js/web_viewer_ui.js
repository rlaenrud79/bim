var Example,Communicator,__awaiter=this&&this.__awaiter||function(e,n,a,l){return new(a=a||Promise)(function(i,t){function s(e){try{o(l.next(e))}catch(e){t(e)}}function r(e){try{o(l.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(s,r)}o((l=l.apply(e,n||[])).next())})};!function(e){class r extends Communicator.Markup.MarkupItem{constructor(e,t,i,s){super(),this._leaderLine=new Communicator.Markup.Shape.Line,this._textBox=new Communicator.Markup.Shape.TextBox,this._showAsColor=!1,this._nodeId=t,this._viewer=e,this._leaderAnchor=i.copy(),this._textBoxAnchor=i.copy(),this._textBox.setTextString(s),this._textBox.getBoxPortion().setFillOpacity(1),this._textBox.getBoxPortion().setFillColor(Communicator.Color.white()),this._textBox.getTextPortion().setFillColor(Communicator.Color.red()),this._textBox.getTextPortion().setFontSize(16),this._leaderLine.setStartEndcapType(Communicator.Markup.Shape.EndcapType.Arrowhead)}draw(){this._behindView=!1;var e=this._viewer.view.projectPoint(this._leaderAnchor),t=this._viewer.view.projectPoint(this._textBoxAnchor),e=(e.z<=0&&(this._behindView=!0),t.z<=0&&(this._behindView=!0),Communicator.Point2.fromPoint3(e)),t=Communicator.Point2.fromPoint3(t),e=(this._leaderLine.set(e,t),this._textBox.setPosition(t),this._viewer.markupManager.getRenderer());e.drawLine(this._leaderLine),e.drawTextBox(this._textBox)}hit(e){var t=this._viewer.markupManager.getRenderer().measureTextBox(this._textBox),i=this._textBox.getPosition();return!(e.x<i.x||e.x>i.x+t.x||e.y<i.y||e.y>i.y+t.y)}setShowAsColor(e){this._showAsColor=e}getShowAsColor(){return this._showAsColor}getNodeId(){return this._nodeId}getLeaderLineAnchor(){return this._leaderAnchor.copy()}getTextBoxAnchor(){return this._textBoxAnchor}setTextBoxAnchor(e){this._textBoxAnchor.assign(e)}setLabel(e){this._textBox.setTextString(e)}getLabel(){return this._textBox.getTextString()}}e.AnnotationMarkup=r;e.AnnotationRegistry=class{constructor(e,t){this._annotationMap={},this._viewer=e,this._pulseManager=t,this._table=document.getElementById("AnnotationRegistry")}getAnnotation(e){return this._annotationMap[e]}export(){var e=[];for(const i of Object.keys(this._annotationMap)){var t=this._annotationMap[i];e.push({name:t.getLabel(),position:t.getLeaderLineAnchor().toJson(),nodeId:t.getNodeId(),showAsColor:t.getShowAsColor()})}return JSON.stringify(e)}addAnnotation(t,e){this._annotationMap[t]=e;var i=document.createElement("tr"),s=(i.id=t,document.createElement("td")),s=(s.id=t+"-nodeId",s.innerText=e.getNodeId().toString(),i.appendChild(s),document.createElement("td")),e=(s.id=t+"-name",s.innerText=e.getLabel(),i.appendChild(s),document.createElement("td")),s=document.createElement("button"),s=(s.innerText="Rename",s.onclick=()=>{this._renameAnnotation(t)},e.appendChild(s),document.createElement("button")),s=(s.innerText="Delete",s.onclick=()=>{this._deleteAnnotation(t)},e.appendChild(s),i.appendChild(e),document.createElement("td")),e=document.createElement("input");e.type="checkbox",e.id=t+"-showAsColor",e.classList.add("showAsColor"),s.appendChild(e),e.onchange=e=>{this._onPulseChange(t,e.target)},i.appendChild(s),this._table.appendChild(i)}_onPulseChange(e,t){e=this.getAnnotation(e);void 0!==e&&(e.setShowAsColor(t.checked),t.checked?this._pulseManager.add(e.getNodeId(),this._pulseManager.getDefaultColor1(),this._pulseManager.getDefaultColor2(),this._pulseManager.getDefaultPulseTime()):(this._pulseManager.deletePulse(e.getNodeId()),this._viewer.redraw()))}_renameAnnotation(e){var t,i,s=this._annotationMap[e];void 0!==s&&null!=(t=prompt("Enter a new name for "+s.getLabel(),s.getLabel()))&&(s.setLabel(t),this._viewer.markupManager.refreshMarkup(),null!==(i=document.getElementById(e+"-name")))&&(i.innerText=t)}_deleteAnnotation(e){this._viewer.markupManager.unregisterMarkup(e);var t=this._annotationMap[e],t=(void 0!==t&&(this._pulseManager.deletePulse(t.getNodeId()),delete this._annotationMap[e]),document.getElementById(e));null!==t&&null!==t.parentElement&&t.parentElement.removeChild(t)}};e.AnnotationOperator=class{constructor(e,t){this._previousAnchorPlaneDragPoint=null,this._activeMarkup=null,this._previousNodeId=null,this._viewer=e,this._annotationRegistry=t}onMouseDown(s){return __awaiter(this,void 0,void 0,function*(){var e,t,i=yield this._viewer.view.pickFromPoint(s.getPosition(),new Communicator.PickConfig(Communicator.SelectionMask.All));null!==i&&0!==i.overlayIndex()||(e=s.getPosition(),this._selectAnnotation(e)?s.setHandled(!0):null!==i&&i.isNodeEntitySelection()&&(t=i.getNodeId(),i=i.getPosition(),i=new r(this._viewer,t,i,this._viewer.model.getNodeName(t)+" Connector"),t=this._viewer.markupManager.registerMarkup(i),this._annotationRegistry.addAnnotation(t,i),this._startDraggingAnnotation(i,e),s.setHandled(!0)))})}onMouseMove(s){return __awaiter(this,void 0,void 0,function*(){if(null!==this._activeMarkup){var t=this._getDragPointOnAnchorPlane(s.getPosition());let e;e=null!==this._previousAnchorPlaneDragPoint&&null!==t?Communicator.Point3.subtract(t,this._previousAnchorPlaneDragPoint):Communicator.Point3.zero();var i=this._activeMarkup.getTextBoxAnchor().add(e);this._activeMarkup.setTextBoxAnchor(i),this._previousAnchorPlaneDragPoint=t,this._viewer.markupManager.refreshMarkup(),s.setHandled(!0)}else{i=(yield this._viewer.view.pickFromPoint(s.getPosition(),new Communicator.PickConfig)).getNodeId();i!==this._previousNodeId&&(null!=this._previousNodeId&&this._viewer.model.setNodesHighlighted([this._previousNodeId],!1),null!=i)&&this._viewer.model.setNodesHighlighted([i],!0),this._previousNodeId=i}})}onMouseUp(e){this._activeMarkup=null,this._previousAnchorPlaneDragPoint=null}_startDraggingAnnotation(e,t){this._activeMarkup=e,this._previousAnchorPlaneDragPoint=this._getDragPointOnAnchorPlane(t)}_selectAnnotation(e){var t=this._viewer.markupManager.pickMarkupItem(e);return!!t&&(this._activeMarkup=t,this._previousAnchorPlaneDragPoint=this._getDragPointOnAnchorPlane(e),!0)}onDeactivate(){null!=this._previousNodeId&&this._viewer.model.setNodesHighlighted([this._previousNodeId],!1),this._previousNodeId=null}_getDragPointOnAnchorPlane(e){var t,i;return null!==this._activeMarkup&&(t=this._activeMarkup.getLeaderLineAnchor(),i=this._viewer.view.getCamera(),i=Communicator.Point3.subtract(i.getPosition(),t).normalize(),t=Communicator.Plane.createFromPointAndNormal(t,i),null!==(i=this._viewer.view.raycastFromPoint(e)))&&(e=Communicator.Point3.zero(),t.intersectsRay(i,e))?e:null}}}(Example=Example||{}),function(p){var t=p.Ui||(p.Ui={});{var e=t.Context||(t.Context={});class r{constructor(e,t){this.action=e,this.element=t}setEnabled(e){e?$(this.element).removeClass("disabled"):$(this.element).addClass("disabled")}setText(e){this.element.innerHTML=e}show(){$(this.element).show()}hide(){$(this.element).hide()}}e.ContextMenuItem=r,e.ContextMenu=class{constructor(e,t,i,s,r){this._activeItemId=null,this._activeLayerName=null,this._activeType=null,this._separatorCount=0,this._position=null,this._modifiers=p.KeyModifiers.None,this._viewer=i,this._containerId=t,this._isolateZoomHelper=s,this._colorPicker=r,this._menuElement=this._createMenuElement(e),this._contextLayer=this._createContextLayer(),this._initElements(),this._viewer.setCallbacks({firstModelLoaded:()=>{this._onNewModel()},modelSwitched:()=>{this._onNewModel()}})}_getContextItemMap(){return this._contextItemMap}_onNewModel(){this._viewer.sheetManager.isDrawingSheetActive()&&(this._contextItemMap.reset.hide(),void 0!==this._contextItemMap.meshlevel0&&this._contextItemMap.meshlevel0.hide(),void 0!==this._contextItemMap.meshlevel1&&this._contextItemMap.meshlevel1.hide(),void 0!==this._contextItemMap.meshlevel2&&this._contextItemMap.meshlevel2.hide(),$(".contextmenu-separator-3").hide())}_isMenuItemEnabled(){if(null!==this._activeLayerName||null!==this._activeType||null!==this._activeItemId&&!this._viewer.noteTextManager.checkPinInstance(this._activeItemId))return!0;for(const e of this._viewer.selectionManager.getResults())if(1!==e.overlayIndex())return!0;return!1}_isMenuItemVisible(){var e=this._isItemVisible(this._activeItemId),t=this._isLayerVisibile(this._activeLayerName),i=this._isTypeVisible(this._activeType);return e||t||i}_isColorSet(r){return __awaiter(this,void 0,void 0,function*(){const t=this._colorPicker.getColor();let i=!0;for(let e=0;e<r.length;++e){var s=yield this._viewer.model.getNodeColorMap(r[e],p.ElementType.Faces);if(0===s.size)return!1;s.forEach(e=>{e.equals(t)||(i=!1)})}return i})}_updateMenuItems(){return __awaiter(this,void 0,void 0,function*(){var e=this.getContextItemIds(!0,!0,!1),t=this._isMenuItemEnabled(),i=this._isMenuItemVisible();this._contextItemMap.visibility.setText(i?"숨기기":"보이기"),this._contextItemMap.visibility.setEnabled(t),this._contextItemMap.isolate.setEnabled(t),this._contextItemMap.zoom.setEnabled(t),this._contextItemMap.transparent.setEnabled(t),this._contextItemMap.setColor.setText((yield this._isColorSet(e))?"색상되돌리기":"색상적용")})}setActiveLayerName(e){return __awaiter(this,void 0,void 0,function*(){this._activeLayerName=t.LayersTree.getLayerName(e),yield this._updateMenuItems()})}setActiveType(e){return __awaiter(this,void 0,void 0,function*(){this._activeType=e,yield this._updateMenuItems()})}setActiveItemId(e){return __awaiter(this,void 0,void 0,function*(){this._activeItemId=e,yield this._updateMenuItems()})}showElements(i){this._viewer.setContextMenuStatus(!0);var s=this._viewer.view.getCanvasSize(),r=$(this._menuElement),o=r.outerWidth(),n=r.outerHeight();if(void 0!==n&&void 0!==o){n>s.y&&r.addClass("small");let e=i.y,t=i.x;e+n>s.y&&(e=s.y-n-1),t+o>s.x&&(t=s.x-o-1),$(this._menuElement).css({left:t+"px",top:e+"px",display:"block"})}$(this._menuElement).show(),$(this._contextLayer).show()}_onContextLayerClick(e){0===e.button&&this.hide()}hide(){this._viewer.setContextMenuStatus(!1),this._activeItemId=null,this._activeLayerName=null,this._activeType=null,$(this._menuElement).hide(),$(this._contextLayer).hide(),$(this._menuElement).removeClass("small")}action(t){return __awaiter(this,void 0,void 0,function*(){var e=this._contextItemMap[t];void 0!==e&&(yield e.action())})}_doMenuClick(e){var e=$(e.target);e.hasClass("disabled")||(void 0!==(e=e.attr("id"))&&this.action(e),this.hide())}_createMenuElement(e){var t=document.createElement("div");return t.classList.add("ui-contextmenu"),t.classList.add(e),t.style.position="absolute",t.style.zIndex="6",t.style.display="none",t.oncontextmenu=()=>!1,t.ontouchmove=e=>{e.preventDefault()},$(t).on("click",".ui-contextmenu-item",e=>{this._doMenuClick(e)}),t}_createContextLayer(){var e=document.createElement("div");return e.style.position="relative",e.style.width="100%",e.style.height="100%",e.style.backgroundColor="transparent",e.style.zIndex="5",e.style.display="none",e.oncontextmenu=()=>!1,e.ontouchmove=e=>{e.preventDefault()},$(e).on("mousedown",e=>{this._onContextLayerClick(e)}),e}_initElements(){this._createDefaultMenuItems();var e=document.getElementById(this._containerId);null!==e&&(e.appendChild(this._menuElement),e.appendChild(this._contextLayer))}_isMenuItemExecutable(){return null!==this._activeItemId||null!==this._activeLayerName||null!==this._activeType||0<this._viewer.selectionManager.size()}_createDefaultMenuItems(){const i=this._viewer.model,e=this._viewer.operatorManager,s=(this._contextItemMap={},e=>e.every(e=>i.hasEffectiveGenericType(e,p.StaticGenericType.IfcSpace)));this.appendItem("isolate","독립객체",()=>__awaiter(this,void 0,void 0,function*(){var e;this._isMenuItemExecutable()&&(e=this.getContextItemIds(!0,!0),yield this._isolateZoomHelper.isolateNodes(e,!s(e)&&null))})),this.appendItem("zoom","당겨보기",()=>__awaiter(this,void 0,void 0,function*(){this._isMenuItemExecutable()&&(yield this._isolateZoomHelper.fitNodes(this.getContextItemIds(!0,!0)))})),this.appendItem("visibility","숨기기",()=>__awaiter(this,void 0,void 0,function*(){var e,t;this._isMenuItemExecutable()&&(e=!this._isMenuItemVisible(),t=this.getContextItemIds(!0,!0),yield i.setNodesVisibility(t,e,!s(t)&&null))})),this.appendSeparator(),this.appendItem("transparent","투명하게",()=>__awaiter(this,void 0,void 0,function*(){var e,t;this._isMenuItemExecutable()&&(e=this.getContextItemIds(!0,!0),null===(t=(yield i.getNodesOpacity([e[0]]))[0])||1===t?i.setNodesOpacity(e,.5):i.resetNodesOpacity(e))})),this.appendSeparator(),this.appendItem("setColor","색상적용",()=>__awaiter(this,void 0,void 0,function*(){var e,t=this.getContextItemIds(!0,!0,!1);0<t.length&&((yield this._isColorSet(t))?this._viewer.model.unsetNodesFaceColor(t):(e=this._colorPicker.getColor().copy(),this._viewer.model.setNodesFaceColor(t,e)))})),this.appendItem("modifyColor","색상설정",()=>__awaiter(this,void 0,void 0,function*(){this._colorPicker.show()})),this.appendSeparator(),this.appendItem("reset","재설정",()=>__awaiter(this,void 0,void 0,function*(){yield e.getOperator(p.OperatorId.Handle).removeHandles(),this._viewer._getCallbackManager().trigger("contextMenuReset")}))}getContextItemIds(e,t,i=!0){const s=this._viewer.selectionManager;var r,o=this._viewer.model,n=o.getAbsoluteRootNode();const a=[];if(e)for(const c of s.getResults()){var l=c.getNodeId();o.isNodeLoaded(l)&&(i||!i&&l!==n)&&a.push(l)}if(null!==this._activeLayerName){var e=this._viewer.model.getLayerIdsFromName(this._activeLayerName);if(null!==e)for(const _ of e){var d=this._viewer.model.getNodesFromLayer(_);if(null!==d)for(const u of d){var h=p.Selection.SelectionItem.create(u);s.contains(h)||a.push(u)}}}return null!==this._activeType&&null!==(e=this._viewer.model.getNodesByGenericType(this._activeType))&&e.forEach(e=>{var t=p.Selection.SelectionItem.create(e);s.contains(t)||a.push(e)}),null!==this._activeItemId&&(e=p.Selection.SelectionItem.create(this._activeItemId),e=null!==s.containsParent(e),r=-1!==a.indexOf(this._activeItemId),t)&&(i||this._activeItemId!==n&&(0===a.length||!r&&!e))&&a.push(this._activeItemId),a}appendItem(e,t,i){var s=document.createElement("div"),t=(s.classList.add("ui-contextmenu-item"),s.innerHTML=t,s.id=e,this._menuElement.appendChild(s),new r(i,s));return this._contextItemMap[e]=t}appendSeparator(){var e=document.createElement("div");e.classList.add("contextmenu-separator-"+this._separatorCount++),e.classList.add("ui-contextmenu-separator"),e.style.width="100%",e.style.height="1px",this._menuElement.appendChild(e)}_isItemVisible(e){if(null===e){var t=this._viewer.selectionManager.getResults();if(0===t.length)return!1;e=t[0].getNodeId()}return this._viewer.model.getNodeVisibility(e)}_isLayerVisibile(e){if(null!==e){e=this._viewer.model.getLayerIdsFromName(e);if(null!==e)for(const i of e){var t=this._viewer.model.getNodesFromLayer(i);if(null!==t)for(const s of t)if(this._viewer.model.getNodeVisibility(s))return!0}}return!1}_isTypeVisible(e){let t=!1;return null!==e&&null!==(e=this._viewer.model.getNodesByGenericType(e))&&e.forEach(e=>{t=t||this._viewer.model.getNodeVisibility(e)}),t}}}}(Communicator=Communicator||{}),function(e){((e=e.Ui||(e.Ui={})).CuttingPlane||(e.CuttingPlane={})).Info=class{constructor(){this.plane=null,this.referenceGeometry=null,this.status=0,this.updateReferenceGeometry=!1}}}(Communicator=Communicator||{}),function(e){var i;e=e.Ui||(e.Ui={}),((i=e.CuttingPlane||(e.CuttingPlane={})).ControllerUtils||(i.ControllerUtils={})).PlaneInfoManager=class{constructor(){this._planeInfoMap=new Map}get X(){return this.get(0)}get Y(){return this.get(1)}get Z(){return this.get(2)}get Face(){return this.get(3)}isHidden(e){return 0===this.get(e).status}get(e){let t=this._planeInfoMap.get(e);return void 0===t&&(t=new i.Info,this._planeInfoMap.set(e,t)),t}reset(e){e=this.get(e);e.plane=null,e.referenceGeometry=null}delete(e){this._planeInfoMap.delete(e)}clear(){this._planeInfoMap.clear()}update(){this._planeInfoMap.forEach(e=>{e.updateReferenceGeometry=!0})}static getCuttingStatus(e,t){return 0<=t.normal.x&&0<=t.normal.y&&0<=t.normal.z||3===e?1:2}static getPlaneSectionIndex(e){var t=Math.abs(e.normal.x),i=Math.abs(e.normal.y),e=Math.abs(e.normal.z);return 1===t&&0===i&&0===e?0:0===t&&1===i&&0===e?1:0===t&&0===i&&1===e?2:3}}}(Communicator=Communicator||{}),function(s){var e;((e=(e=s.Ui||(s.Ui={})).CuttingPlane||(e.CuttingPlane={})).ControllerUtils||(e.ControllerUtils={})).CuttingSectionManager=class{constructor(){this._useIndividualCuttingSections=!0,this._cuttingManager=null}get useIndividualCuttingSections(){return this._useIndividualCuttingSections}set useIndividualCuttingSections(e){this._useIndividualCuttingSections=e}get X(){if(this._cuttingManager)return this._cuttingManager.getCuttingSection(0);throw new Error("Ui.CuttingSectionManager as not been initialized")}get Y(){if(this._cuttingManager)return this._cuttingManager.getCuttingSection(1);throw new Error("Ui.CuttingSectionManager as not been initialized")}get Z(){if(this._cuttingManager)return this._cuttingManager.getCuttingSection(2);throw new Error("Ui.CuttingSectionManager as not been initialized")}get Face(){if(this._cuttingManager)return this._cuttingManager.getCuttingSection(3);throw new Error("Ui.CuttingSectionManager as not been initialized")}get activeStates(){return[this.isActive(0),this.isActive(1),this.isActive(2),this.isActive(3)]}get planes(){return 1<this.X.getCount()?[...Array(4)].map((e,t)=>this.X.getPlane(t)):[this.X,this.Y,this.Z,this.Face].map(e=>e.getPlane(0))}get referenceGeometry(){return 1<this.X.getCount()?[...Array(4)].map((e,t)=>this.X.getReferenceGeometry(t)):[this.X,this.Y,this.Z,this.Face].map(e=>e.getReferenceGeometry(0))}get(e){if(this._cuttingManager)return this._cuttingManager.getCuttingSection(e);throw new Error("Ui.CuttingSectionManager as not been initialized")}getCount(){return[this.X,this.Y,this.Z,this.Face].reduce((e,t)=>e+t.getCount(),0)}init(e){this._cuttingManager=e.cuttingManager}isActive(e){if(this._cuttingManager)return this.get(e).isActive();throw new Error("Ui.CuttingSectionManager as not been initialized")}activate(t){return __awaiter(this,void 0,void 0,function*(){var e=this.get(t);if(0<e.getCount())return e.activate()})}activateAll(i){return __awaiter(this,void 0,void 0,function*(){yield Promise.all([0,1,2,3].map((e,t)=>!i||i[t]?this.activate(e):null).filter(Boolean))})}deactivate(e){return this.get(this.getCuttingSectionIndex(e)).deactivate()}getCuttingSectionIndex(e){return this.useIndividualCuttingSections?e:0}clear(e){return __awaiter(this,void 0,void 0,function*(){return this.get(e).clear()})}clearAll(){return __awaiter(this,void 0,void 0,function*(){var e=[0,1,2,3].map(e=>__awaiter(this,void 0,void 0,function*(){return this.clear(e)}));yield Promise.all(e)})}getPlaneIndex(t,i){if(this._useIndividualCuttingSections){if(this.get(this.getCuttingSectionIndex(t)).getPlane(0))return 0}else{var s=this.get(0),r=s.getCount();for(let e=0;e<r;e++){var o=s.getPlane(e);if(o&&(o.normal.x&&0===t||o.normal.y&&1===t||o.normal.z&&2===t||3===t&&i&&o.normal.equals(i)))return e}}return-1}getPlaneAndGeometry(e,t){var i=this.get(this.getCuttingSectionIndex(e));return i.getCount()<=0?{plane:null,referenceGeometry:null}:(e=this.getPlaneIndex(e,t),{plane:i.getPlane(e),referenceGeometry:i.getReferenceGeometry(e)})}getReferenceGeometry(e,t){if(!this._cuttingManager)throw new Error("Ui.CuttingSectionManager as not been initialized");let i;switch(e){case 0:i=s.Axis.X;break;case 1:i=s.Axis.Y;break;case 2:i=s.Axis.Z}return void 0!==i?this._cuttingManager.createReferenceGeometryFromAxis(i,t):[]}addPlane(e,t,i){return __awaiter(this,void 0,void 0,function*(){yield this.get(this.getCuttingSectionIndex(e)).addPlane(t,i)})}}}(Communicator=Communicator||{}),function(e){var t;((t=(t=e.Ui||(e.Ui={})).CuttingPlane||(t.CuttingPlane={})).ControllerUtils||(t.ControllerUtils={})).BoundingManager=class{constructor(){this._modelBounding=new e.Box}get box(){return this._modelBounding}init(e){return __awaiter(this,void 0,void 0,function*(){this._modelBounding=yield e.model.getModelBounding(!0,!1)})}update(s){return __awaiter(this,void 0,void 0,function*(){var e=yield s.model.getModelBounding(!0,!1),t=this._modelBounding.min.equalsWithTolerance(e.min,.01),i=this._modelBounding.max.equalsWithTolerance(e.max,.01);return!(t&&i||(this._modelBounding=e,0))})}}}(Communicator=Communicator||{}),function(e){((e=(e=e.Ui||(e.Ui={})).CuttingPlane||(e.CuttingPlane={})).ControllerUtils||(e.ControllerUtils={})).FaceSelectionManager=class{constructor(){this._faceSelection=null}reset(e=null){this._faceSelection=e}get isSet(){return null!==this._faceSelection}get normal(){return this._faceSelection?this._faceSelection.getFaceEntity().getNormal():void 0}get position(){return this._faceSelection?this._faceSelection.getPosition():void 0}getReferenceGeometry(e,t){return this.isSet?e.cuttingManager.createReferenceGeometryFromFaceNormal(this.normal,this.position,t):[]}}}(Communicator=Communicator||{}),function(r){var e=r.Ui||(r.Ui={});e=e.CuttingPlane||(e.CuttingPlane={});{e=e.ControllerUtils||(e.ControllerUtils={});class t extends r.Util.StateMachine{constructor(e){super({name:"not initialized",controller:e},o)}}function o(e,{name:t,payload:i}){const s=e=>"update triggered"===e.name;switch(t){case"init":r.Util.delayCall(()=>__awaiter(this,void 0,void 0,function*(){e.name="updating",yield e.controller.init(),s(e)?o(e,{name:"update",payload:i}):e.name="outdated"}));break;case"update":if("not initialized"===e.name)throw new Error("CuttingPlane.Controller.StateMachine has not been initialized");s(e)||("updating"===e.name?e.name="update triggered":r.Util.delayCall(()=>__awaiter(this,void 0,void 0,function*(){e.name="updating",yield e.controller.update(),s(e)?o(e,{name:"update",payload:i}):e.name="up to date"})));break;case"refresh":if("not initialized"===e.name)throw new Error("CuttingPlane.Controller.StateMachine has not been initialized");r.Util.delayCall(()=>__awaiter(this,void 0,void 0,function*(){e.name="updating",yield e.controller.refresh(),s(e)?o(e,{name:"update",payload:i}):e.name="up to date"}));break;case"clear":if("not initialized"===e.name)throw new Error("CuttingPlane.Controller.StateMachine has not been initialized");r.Util.delayCall(()=>__awaiter(this,void 0,void 0,function*(){e.name="updating",yield e.controller.clear(),s(e)?o(e,{name:"update",payload:i}):e.name="up to date"}))}return e}e.StateMachine=t,e.defaultReducer=o}}(Communicator=Communicator||{}),function(o){var e,a;e=o.Ui||(o.Ui={}),(a=e.CuttingPlane||(e.CuttingPlane={})).Controller=class{constructor(e){this._planeInfoMgr=new a.ControllerUtils.PlaneInfoManager,this._cuttingSectionsMgr=new a.ControllerUtils.CuttingSectionManager,this._modelBoundingMgr=new a.ControllerUtils.BoundingManager,this._faceSelectionMgr=new a.ControllerUtils.FaceSelectionManager,this._showReferenceGeometry=!0,this._pendingFuncs={},this._viewer=e,this._stateMachine=new a.ControllerUtils.StateMachine(this),this._viewer.setCallbacks({assemblyTreeReady:()=>this._stateMachine.handle("init"),visibilityChanged:()=>this._stateMachine.handle("update"),hwfParseComplete:()=>this._stateMachine.handle("update"),firstModelLoaded:()=>this._stateMachine.handle("refresh"),modelSwitched:()=>this._stateMachine.handle("refresh"),modelSwitchStart:()=>this._stateMachine.handle("clear")})}init(){return __awaiter(this,void 0,void 0,function*(){yield this._initSection(),yield this._updateBoundingBox()})}update(){return __awaiter(this,void 0,void 0,function*(){yield this._updateBoundingBox()})}refresh(){return __awaiter(this,void 0,void 0,function*(){yield this._updateBoundingBox(),yield this.resetCuttingPlanes()})}clear(){return __awaiter(this,void 0,void 0,function*(){yield this._cuttingSectionsMgr.clearAll()})}get individualCuttingSectionEnabled(){return this._cuttingSectionsMgr.useIndividualCuttingSections}getPlaneStatus(e){return this._planeInfoMgr.get(e).status}onSectionsChanged(){return __awaiter(this,void 0,void 0,function*(){var t=this._cuttingSectionsMgr.planes,i=this._cuttingSectionsMgr.referenceGeometry,e=0===t.filter(e=>null===e).length,s=0===i.filter(e=>null!==e).length;this._showReferenceGeometry=!e||!s,this._cuttingSectionsMgr.useIndividualCuttingSections=this._cuttingSectionsMgr.X.getCount()<=1,this._resetCuttingData();for(let e=0;e<t.length;++e){var r,o,n=t[e];null!==n&&(r=a.ControllerUtils.PlaneInfoManager.getPlaneSectionIndex(n),0===(o=this._planeInfoMgr.get(r)).status)&&(o.status=a.ControllerUtils.PlaneInfoManager.getCuttingStatus(r,n),o.plane=n,o.referenceGeometry=i[e])}this._viewer.pauseRendering(),yield this._cuttingSectionsMgr.clearAll(),yield this._restorePlanes(),this._viewer.resumeRendering()})}getReferenceGeometryEnabled(){return this._showReferenceGeometry}_updateBoundingBox(){return __awaiter(this,void 0,void 0,function*(){var e;(yield this._modelBoundingMgr.update(this._viewer))&&(this._planeInfoMgr.update(),e=this._cuttingSectionsMgr.activeStates,this._storePlanes(),yield this._cuttingSectionsMgr.clearAll(),yield this._restorePlanes(e))})}_resetCuttingData(){this._planeInfoMgr.clear(),this._faceSelectionMgr.reset()}resetCuttingPlanes(){return this._resetCuttingData(),this._showReferenceGeometry=!0,this._cuttingSectionsMgr.clearAll()}_initSection(){return __awaiter(this,void 0,void 0,function*(){yield Promise.all([this._modelBoundingMgr.init(this._viewer),this._cuttingSectionsMgr.init(this._viewer),this._triggerPendingFuncs()])})}_triggerPendingFuncs(){return __awaiter(this,void 0,void 0,function*(){var e;this._pendingFuncs.inverted&&(e=this._pendingFuncs.inverted,delete this._pendingFuncs.inverted,yield e()),this._pendingFuncs.visibility&&(e=this._pendingFuncs.visibility,delete this._pendingFuncs.visibility,yield e())})}toggle(i){return __awaiter(this,void 0,void 0,function*(){var e,t=this._planeInfoMgr.get(i);switch(t.status){case 0:3===i?null!==(e=this._viewer.selectionManager.getLast())&&e.isFaceSelection()&&(this._faceSelectionMgr.reset(e),yield this._cuttingSectionsMgr.Face.clear(),t.status=1,yield this.setCuttingPlaneVisibility(!0,i)):(t.status=1,yield this.setCuttingPlaneVisibility(!0,i));break;case 1:t.status=2,yield this.setCuttingPlaneInverted(i);break;case 2:t.status=0,yield this.setCuttingPlaneVisibility(!1,i)}})}getCount(){return this._cuttingSectionsMgr.getCount()}setCuttingPlaneVisibility(i,s){return __awaiter(this,void 0,void 0,function*(){var e,t=this._cuttingSectionsMgr.getCuttingSectionIndex(s);void 0===this._cuttingSectionsMgr.get(t)?this._pendingFuncs.visibility=()=>__awaiter(this,void 0,void 0,function*(){yield this.setCuttingPlaneVisibility(i,s)}):(this._viewer.delayCapping(),i?(null===(t=this._planeInfoMgr.get(s)).plane&&(t.plane=this._generateCuttingPlane(s),t.referenceGeometry=this._generateReferenceGeometry(s)),yield this._setSection(s)):yield this.refreshPlaneGeometry(),t=this.getCount(),e=this._cuttingSectionsMgr.isActive(s),0<t&&!e?yield this._cuttingSectionsMgr.activateAll():e&&0===t&&(yield this._cuttingSectionsMgr.deactivate(s)))})}setCuttingPlaneInverted(s){return __awaiter(this,void 0,void 0,function*(){var e,t,i=this._cuttingSectionsMgr.get(this._cuttingSectionsMgr.getCuttingSectionIndex(s));void 0===i?this._pendingFuncs.inverted=()=>__awaiter(this,void 0,void 0,function*(){yield this.setCuttingPlaneInverted(s)}):(this._viewer.delayCapping(),e=this._cuttingSectionsMgr.getPlaneIndex(s,this._faceSelectionMgr.normal),(t=i.getPlane(e))&&(t.normal.negate(),t.d*=-1,yield i.updatePlane(e,t,new o.Matrix,!1,!1)))})}toggleReferenceGeometry(){return __awaiter(this,void 0,void 0,function*(){0<this.getCount()&&(this._showReferenceGeometry=!this._showReferenceGeometry,yield this.refreshPlaneGeometry())})}refreshPlaneGeometry(){return __awaiter(this,void 0,void 0,function*(){this._storePlanes(),yield this._cuttingSectionsMgr.clearAll(),yield this._restorePlanes()})}toggleCuttingMode(){return __awaiter(this,void 0,void 0,function*(){1<this.getCount()&&(this._storePlanes(),yield this._cuttingSectionsMgr.clearAll(),this._cuttingSectionsMgr.useIndividualCuttingSections=!this._cuttingSectionsMgr.useIndividualCuttingSections,yield this._restorePlanes())})}_setSection(i){return __awaiter(this,void 0,void 0,function*(){var{plane:e,referenceGeometry:t}=this._planeInfoMgr.get(i);if(null!==e)return this._cuttingSectionsMgr.addPlane(i,e,this._showReferenceGeometry?t:null)})}_restorePlane(t){return __awaiter(this,void 0,void 0,function*(){var e=this._planeInfoMgr.get(t);void 0!==e&&null!==e.plane&&0!==e.status&&(null!==e.referenceGeometry&&!e.updateReferenceGeometry||(e.referenceGeometry=this._generateReferenceGeometry(t)),yield this._setSection(t))})}_restorePlanes(e){return __awaiter(this,void 0,void 0,function*(){yield Promise.all([this._restorePlane(0),this._restorePlane(1),this._restorePlane(2),this._restorePlane(3)]),yield this._cuttingSectionsMgr.activateAll(e)})}_storePlanes(){var e=new Map([0,1,2,3].map(e=>(this._planeInfoMgr.reset(e),[e,this._planeInfoMgr.get(e)])).filter(([e])=>!this._planeInfoMgr.isHidden(e)));const s=this._faceSelectionMgr.normal;e.forEach((e,t)=>{var{plane:t,referenceGeometry:i}=this._cuttingSectionsMgr.getPlaneAndGeometry(t,s);e.plane=t,e.referenceGeometry=i})}_generateReferenceGeometry(e){return 3===e?this._faceSelectionMgr.getReferenceGeometry(this._viewer,this._modelBoundingMgr.box):this._cuttingSectionsMgr.getReferenceGeometry(e,this._modelBoundingMgr.box)}_generateCuttingPlane(e){var t=new o.Plane,i=this._modelBoundingMgr.box;switch(e){case 0:t.normal.set(1,0,0),t.d=-i.max.x;break;case 1:t.normal.set(0,1,0),t.d=-i.max.y;break;case 2:t.normal.set(0,0,1),t.d=-i.max.z;break;case 3:if(!this._faceSelectionMgr.isSet)return null;var s=this._faceSelectionMgr.normal,r=this._faceSelectionMgr.position;t.setFromPointAndNormal(r,s)}return t}}}(Communicator=Communicator||{}),function(e){{e=e.Ui||(e.Ui={});class t extends e.CuttingPlane.Info{}e.CuttingPlaneInfo=t;class i extends e.CuttingPlane.Controller{getIndividualCuttingSectionEnabled(){return this.individualCuttingSectionEnabled}getPlaneInfo(e){return this._planeInfoMgr.get(e)}}e.CuttingPlaneController=i}}(Communicator=Communicator||{}),function(n){function s(i,e){var t=i.model;const s=i.sheetManager.getActiveSheetId();if(null!==s){var r=t.getNodeParent(s);const o=t.getNodeChildren(r);n.Util.filterInPlace(e,e=>{let t=e;for(;null!==t;){if(t===s)return!0;if(-1!==o.indexOf(t))return!1;t=i.model.getNodeParent(t)}return!0})}}n._filterActiveSheetNodeIds=s;n.IsolateZoomHelper=class{constructor(e){this._camera=null,this._deselectOnIsolate=!0,this._deselectOnZoom=!0,this._isolateStatus=!1,this._viewer=e,this._noteTextManager=this._viewer.noteTextManager,this._viewer.setCallbacks({modelSwitched:()=>{this._camera=null}})}_setCamera(e){null===this._camera&&(this._camera=e)}setDeselectOnIsolate(e){this._deselectOnIsolate=e}getIsolateStatus(){return this._isolateStatus}isolateNodes(e,t=null){var i=this._viewer.view,i=(this._setCamera(i.getCamera()),s(this._viewer,e),i.isolateNodes(e,n.DefaultTransitionDuration,!this._viewer.sheetManager.isDrawingSheetActive(),t));return this._deselectOnIsolate&&this._viewer.selectionManager.clear(),this._isolateStatus=!0,i}fitNodes(e){var t=this._viewer.view,t=(this._setCamera(t.getCamera()),t.fitNodes(e));return this._deselectOnZoom&&this._viewer.selectionManager.clear(),t}showAll(){var e,t,i=this._viewer.model;return this._viewer.sheetManager.isDrawingSheetActive()?null!==(e=this._viewer.sheetManager.getActiveSheetId())?this.isolateNodes([e]):Promise.resolve():(e=[],i.isDrawing()?(t=this._viewer.sheetManager.get3DNodes(),e.push(this.isolateNodes(t))):e.push(i.resetNodesVisibility()),null!==this._camera&&(this._viewer.view.setCamera(this._camera,n.DefaultTransitionDuration),this._camera=null),this._isolateStatus=!1,e.push(this._updatePinVisibility()),n.Util.waitForAll(e))}_updatePinVisibility(){return this._noteTextManager.setIsolateActive(this._isolateStatus),this._noteTextManager.updatePinVisibility()}}}(Communicator=Communicator||{}),function(e){class r{constructor(e,t,i,s){this.direction=0,this.progress=0,this.id=e,this.color1=t.copy(),this.color2=i.copy(),this.duration=s}}e.PulseManager=class{constructor(e){this._pulseInfoMap={},this._defaultColor1=Communicator.Color.red(),this._defaultColor2=new Communicator.Color(175,0,0),this._defaultPulseTime=1e3,this._viewer=e}start(){setTimeout(()=>{this.update()},30)}deletePulse(e){this._pulseInfoMap.hasOwnProperty(e.toString())&&(this._viewer.model.unsetNodesFaceColor([e]),delete this._pulseInfoMap[e])}add(e,t,i,s){this.deletePulse(e);t=new r(e,t,i,s);this._pulseInfoMap[e]=t}update(){null==this._previousTime&&(this._previousTime=Date.now());var e=Date.now(),i=e-this._previousTime,s={};let r=!1;for(const a of Object.keys(this._pulseInfoMap)){var o=this._pulseInfoMap[a],n=(r=!0,o.progress=Math.min(o.progress+i,o.duration),o.progress/o.duration);let e,t;t=0===o.direction?(e=o.color1,o.color2):(e=o.color2,o.color1);n=new Communicator.Color(e.r+(t.r-e.r)*n,e.g+(t.g-e.g)*n,e.b+(t.b-e.b)*n);s[o.id]=n,o.progress>=o.duration&&(o.direction=0===o.direction?1:0,o.progress=0)}r&&(this._viewer.model.setNodesColors(s),this._viewer.redraw()),this._previousTime=e,this.start()}getDefaultColor1(){return this._defaultColor1.copy()}getDefaultColor2(){return this._defaultColor2.copy()}getDefaultPulseTime(){return this._defaultPulseTime}}}(Example=Example||{}),function(s){{var e=s.Ui||(s.Ui={});class t extends e.Context.ContextMenu{constructor(e,t,i,s){super("rightclick",e,t,i,s),this._initEvents()}_initEvents(){this._viewer.setCallbacks({contextMenu:(e,t)=>__awaiter(this,void 0,void 0,function*(){this._modifiers=t,yield this.doContext(e)})})}_getSelectionNoTransItem(e,t){return __awaiter(this,void 0,void 0,function*(){const r=this._viewer.model;var o;return yield this._viewer.view.pickAllFromPoint(e,t).then(function(s){return __awaiter(this,void 0,void 0,function*(){for(var e=0;e<s.length;e++){const i=s[e];if(void 0!==i&&i.isEntitySelection()){var t=i.getNodeId();if(yield r.getNodesHaveTransparency([t]).then(e=>{e[0]||(o=i)}),null!=o)break}}})}),o})}doContext(i){return __awaiter(this,void 0,void 0,function*(){var e=new s.PickConfig(s.SelectionMask.All),e=yield this._getSelectionNoTransItem(i,e);let t;void 0===(t=e.isNodeSelection()?this._viewer.model.getNodeType(e.getNodeId()):t)||t===s.NodeType.Pmi||t===s.NodeType.PmiBody||1===e.overlayIndex()?yield this.setActiveItemId(null):yield this.setActiveItemId(e.getNodeId()),this._position=e.getPosition(),this.showElements(i)})}_onContextLayerClick(e){const t=Object.create(null,{_onContextLayerClick:{get:()=>super._onContextLayerClick}});return __awaiter(this,void 0,void 0,function*(){2===e.button?yield this.doContext(new s.Point2(e.pageX,e.pageY)):t._onContextLayerClick.call(this,e)})}}e.RightClickContextMenu=t}}(Communicator=Communicator||{}),function(i){(i.Ui||(i.Ui={})).StreamingIndicator=class{constructor(e,t){this._bottomLeftOffset=new i.Point2(10,10),this._opacity=.5,this._spinnerImageUrl="/dist/css/bim-style/hoops/images/spinner.gif",this._spinnerSize=new i.Point2(31,31),this._viewer=t,this._container=document.getElementById(e),this._initContainer(),this._viewer.setCallbacks({streamingActivated:()=>{this._onStreamingActivated()},streamingDeactivated:()=>{this._onStreamingDeactivated()},_shutdownBegin:()=>{this._onStreamingDeactivated()}})}show(){this._container.style.display="block"}hide(){this._container.style.display="none"}setBottomLeftOffset(e){this._bottomLeftOffset.assign(e),this._container.style.left=this._bottomLeftOffset.x+"px",this._container.style.bottom=this._bottomLeftOffset.y+"px"}getBottomLeftOffset(){return this._bottomLeftOffset.copy()}setSpinnerImage(e,t){this._spinnerImageUrl=e,this._spinnerSize.assign(t),this._container.style.backgroundImage=`url(${this._spinnerImageUrl})`,this._container.style.width=this._spinnerSize.x+"px",this._container.style.height=this._spinnerSize.y+'"px'}_initContainer(){this._container.style.position="absolute",this._container.style.width=this._spinnerSize.x+"px",this._container.style.height=this._spinnerSize.y+"px",this._container.style.left=this._bottomLeftOffset.x+"px",this._container.style.bottom=this._bottomLeftOffset.y+"px",this._container.style.backgroundImage=`url(${this._spinnerImageUrl})`,this._container.style.opacity=""+this._opacity}_onStreamingActivated(){this.show()}_onStreamingDeactivated(){this.hide()}}}(Communicator=Communicator||{}),function(e){{e=e.Ui||(e.Ui={});class t{constructor(e){this._containerId=e,this._textDiv=t._createTextDiv(),this._windowElement=t._createWindowElement(),this._headerDiv=t._createHeaderDiv(),this._initElements()}static _createWindowElement(){var e=document.createElement("div");return e.classList.add("ui-timeout-window"),e.classList.add("desktop-ui-window"),e}static _createHeaderDiv(){var e=document.createElement("div");return e.classList.add("desktop-ui-window-header"),e}static _createTextDiv(){return document.createElement("div")}_initElements(){var e=document.createElement("div"),t=(e.classList.add("desktop-ui-window-content"),e.appendChild(this._textDiv),document.createElement("div")),t=(t.classList.add("desktop-ui-window-divider"),e.appendChild(t),document.createElement("button")),t=(t.innerHTML="Ok",$(t).button().on("click",()=>{this._onOkButtonClick()}),e.appendChild(t),this._windowElement.appendChild(this._headerDiv),this._windowElement.appendChild(e),document.getElementById(this._containerId));null!==t&&t.appendChild(this._windowElement)}_onOkButtonClick(){this.hide()}show(){$(this._windowElement).show()}hide(){$(this._windowElement).hide()}setText(e){$(this._textDiv).empty(),this._textDiv.appendChild(document.createTextNode(e))}setTitle(e){$(this._headerDiv).empty(),this._headerDiv.appendChild(document.createTextNode(e))}}e.UiDialog=t}}(Communicator=Communicator||{}),function(e){{e=e.Ui||(e.Ui={});class t extends e.UiDialog{constructor(e,t){super(e),this._viewer=t,this._viewer.setCallbacks({timeoutWarning:()=>{this._onTimeoutWarning()},timeout:()=>{this._onTimeout()}}),this.setTitle("Timeout Warning")}_onTimeoutWarning(){this.setText("Your session will expire soon. Press Ok to stay connected."),this.show()}_onOkButtonClick(){this._viewer.resetClientTimeout(),super._onOkButtonClick()}_onTimeout(){this.setText("Your session has been disconnected due to inactivity."),this.show()}}e.TimeoutWarningDialog=t}}(Communicator=Communicator||{}),function(a){var s;(s=a.Ui||(a.Ui={})).Toolbar=class{constructor(e,t,i=a.ScreenConfiguration.Desktop){this._toolbarSelector="#toolBar",this._screenElementSelector="#content",this._cuttingPlaneXSelector="#cuttingplane-x",this._cuttingPlaneYSelector="#cuttingplane-y",this._cuttingPlaneZSelector="#cuttingplane-z",this._cuttingPlaneFaceSelector="#cuttingplane-face",this._cuttingPlaneVisibilitySelector="#cuttingplane-section",this._cuttingPlaneGroupToggle="#cuttingplane-toggle",this._cuttingPlaneResetSelector="#cuttingplane-reset",this._selectedClass="selected",this._disabledClass="disabled",this._invertedClass="inverted",this._submenuHeightOffset=10,this._viewOrientationDuration=500,this._activeSubmenu=null,this._actionsNullary=new Map,this._actionsBoolean=new Map,this._isInitialized=!1,this._viewer=e,this._noteTextManager=this._viewer.noteTextManager,this._screenConfiguration=i,this._cuttingPlaneController=t,this._viewerSettings=new s.Desktop.ViewerSettings(e),this._viewer.setCallbacks({selectionArray:e=>{0<e.length?null!==(e=e[e.length-1].getSelection())&&e.isFaceSelection()&&($(this._cuttingPlaneFaceSelector).removeClass(this._disabledClass),$("#view-face").removeClass(this._disabledClass)):($(this._cuttingPlaneFaceSelector).addClass(this._disabledClass),$("#view-face").addClass(this._disabledClass))},cuttingSectionsLoaded:()=>this._cuttingPlaneController.onSectionsChanged().then(()=>{this._updateCuttingPlaneIcons()})})}init(){this._isInitialized||(this._initIcons(),this._removeNonApplicableIcons(),$(".hoops-tool").on("click",e=>(e.preventDefault(),this._processButtonClick(e),!1)),$(".submenu-icon").on("click",e=>(e.preventDefault(),this._submenuIconClick(e.target),!1)),$(this._toolbarSelector).on("touchmove",e=>{e.originalEvent&&e.originalEvent.preventDefault()}),$(this._toolbarSelector).on("mouseenter",()=>{this._mouseEnter()}),$(this._toolbarSelector).on("mouseleave",()=>{this._mouseLeave()}),$(".tool-icon, .submenu-icon").on("mouseenter",e=>{this._mouseEnterItem(e)}),$(".tool-icon, .submenu-icon").on("mouseleave",e=>{this._mouseLeaveItem(e)}),$(window).on("resize",()=>{this.reposition()}),$(this._toolbarSelector).on("click",()=>{null!==this._activeSubmenu&&this._hideActiveSubmenu()}),$(".toolbar-cp-plane").on("click",e=>__awaiter(this,void 0,void 0,function*(){yield this._cuttingPlaneButtonClick(e)})),this._viewer.setCallbacks({modelSwitched:()=>{this._hideActiveSubmenu()}}),this._initSliders(),this._initActions(),this._initSnapshot(),this.updateEdgeFaceButton(),this.reposition(),this.show(),this._isInitialized=!0)}_getViewerSettings(){return this._viewerSettings}disableSubmenuItem(e){"string"==typeof e?$("#submenus .toolbar-"+e).addClass(this._disabledClass):"object"==typeof e&&$.each(e,(e,t)=>{$("#submenus .toolbar-"+t).addClass(this._disabledClass)})}enableSubmenuItem(e){"string"==typeof e?$("#submenus .toolbar-"+e).removeClass(this._disabledClass):"object"==typeof e&&$.each(e,(e,t)=>{$("#submenus .toolbar-"+t).removeClass(this._disabledClass)})}setCorrespondingButtonForSubmenuItem(e){e=$("#submenus .toolbar-"+e);this._activateSubmenuItem(e)}_mouseEnterItem(e){e=$(e.target);e.hasClass(this._disabledClass)||e.addClass("hover")}_mouseLeaveItem(e){$(e.target).removeClass("hover")}show(){$(this._toolbarSelector).show()}hide(){$(this._toolbarSelector).hide()}_initSliders(){$("#explosion-slider").slider({orientation:"vertical",min:0,max:200,value:0,slide:(e,t)=>__awaiter(this,void 0,void 0,function*(){yield this._onExplosionSlider((t.value||0)/100)})})}_mouseEnter(){var e;null===this._activeSubmenu&&((e=$(this._toolbarSelector).find(".toolbar-tools")).stop(),e.css({opacity:1}))}_mouseLeave(){null===this._activeSubmenu&&$(".toolbar-tools").animate({opacity:.6},500,()=>{})}reposition(){var e,t=$(this._toolbarSelector),i=$(this._screenElementSelector);void 0!==t&&void 0!==i&&(i=i.width(),void 0!==(e=t.width()))&&void 0!==i&&t.css({left:i/2-e/2+"px",bottom:"15px"})}_processButtonClick(e){var t;null!==this._activeSubmenu?this._hideActiveSubmenu():null!==e&&(e=e.target,(t=$(e).closest(".hoops-tool")).hasClass("toolbar-radio")?t.hasClass("active-tool")?this._showSubmenu(e):($(this._toolbarSelector).find(".active-tool").removeClass("active-tool"),t.addClass("active-tool"),this._performNullaryAction(t.data("operatorclass"))):t.hasClass("toolbar-menu")?this._showSubmenu(e):t.hasClass("toolbar-menu-toggle")?this._toggleMenuTool(t):this._performNullaryAction(t.data("operatorclass")))}_toggleMenuTool(e){var t=$("#"+e.data("submenu"));t.is(":visible")?(t.hide(),this._performBooleanAction(e.data("operatorclass"),!1)):(this._alignMenuToTool(t,e),this._performBooleanAction(e.data("operatorclass"),!0))}_startModal(){$("body").append("<div id='toolbar-modal' class='toolbar-modal-overlay'></div>"),$("#toolbar-modal").on("click",()=>{this._hideActiveSubmenu()})}_alignMenuToTool(e,t){let i=t.position().left;this._screenConfiguration===a.ScreenConfiguration.Mobile&&(i/=1.74);var t=e.width(),s=e.height();void 0!==t&&void 0!==s&&(t=i-t/2+20,s=-(this._submenuHeightOffset+s),e.css({display:"block",left:t+"px",top:s+"px"}))}_showSubmenu(e){this._hideActiveSubmenu();var e=$(e).closest(".hoops-tool"),t=e.data("submenu");t&&!(t=$(this._toolbarSelector+" #submenus #"+t)).hasClass(this._disabledClass)&&(this._alignMenuToTool(t,e),this._activeSubmenu=t[0],this._startModal(),$(this._toolbarSelector).find(".toolbar-tools").css({opacity:.3}))}_hideActiveSubmenu(){$("#toolbar-modal").remove(),null!==this._activeSubmenu&&($(this._activeSubmenu).hide(),$(this._toolbarSelector).find(".toolbar-tools").css({opacity:1})),this._activeSubmenu=null}_activateSubmenuItem(e){var t=e.closest(".toolbar-submenu"),i=e.data("operatorclass");if("string"!=typeof i)throw new a.CommunicatorError("Invalid submenuItem.");var t=$("#"+t.data("button")),s=t.find(".tool-icon");return s.length&&(s.removeClass(t.data("operatorclass").toString()),s.addClass(i),t.data("operatorclass",i),void 0!==(s=e.attr("title")))&&t.attr("title",s),i}_submenuIconClick(e){var e=$(e);e.hasClass(this._disabledClass)||(e=this._activateSubmenuItem(e),this._hideActiveSubmenu(),this._performNullaryAction(e))}_initIcons(){$(this._toolbarSelector).find(".hoops-tool").each(function(){var e=$(this);e.find(".tool-icon").addClass(e.data("operatorclass").toString())}),$(this._toolbarSelector).find(".submenu-icon").each(function(){var e=$(this);e.addClass(e.data("operatorclass").toString())})}_removeNonApplicableIcons(){this._screenConfiguration===a.ScreenConfiguration.Mobile&&$("#snapshot-button").remove()}setSubmenuEnabled(e,t){var e=$("#"+e),i=$("#"+e.data("submenu"));t?(e.find(".smarrow").show(),i.removeClass(this._disabledClass)):(e.find(".smarrow").hide(),i.addClass(this._disabledClass))}_performNullaryAction(e){e=this._actionsNullary.get(e);e&&e()}_performBooleanAction(e,t){e=this._actionsBoolean.get(e);e&&e(t)}_renderModeClick(e){var t=this._viewer.view;switch(e){case"toolbar-shaded":t.setDrawMode(a.DrawMode.Shaded);break;case"toolbar-wireframe":t.setDrawMode(a.DrawMode.Wireframe);break;case"toolbar-hidden-line":t.setDrawMode(a.DrawMode.HiddenLine);break;case"toolbar-xray":t.setDrawMode(a.DrawMode.XRay);break;default:t.setDrawMode(a.DrawMode.WireframeOnShaded)}}_initSnapshot(){$("#snapshot-dialog-cancel-button").button().on("click",()=>{$("#snapshot-dialog").hide()})}_doSnapshot(){return __awaiter(this,void 0,void 0,function*(){var e,t=this._viewer.view.getCanvasSize(),i=480,s=(t.x,t.y,$("#content")),r=s.width(),s=s.height();void 0!==s&&void 0!==r&&(i=.7*s,e=40+(s=.7*r),t=new a.SnapshotConfig(t.x,t.y),t=yield this._viewer.takeSnapshot(t),r=(r-s)/2,s=$("#snapshot-dialog"),$(".snapshot-dialog-image").attr("src",t.src).attr("width",e).attr("height",40+i),s.css({top:"45px",left:r+"px"}),s.show())})}_setRedlineOperator(e){this._viewer.operatorManager.set(e,1)}_initActions(){const e=this._viewer.view,t=this._viewer.operatorManager;this._actionsNullary.set("toolbar-home",()=>{var e;this._viewer.reset(),this._viewer.sheetManager.isDrawingSheetActive()||(this._noteTextManager.setIsolateActive(!1),this._noteTextManager.updatePinVisibility(),null!==(e=t.getOperator(a.OperatorId.Handle))&&e.removeHandles&&e.removeHandles())}),this._actionsNullary.set("toolbar-redline-circle",()=>{this._setRedlineOperator(a.OperatorId.RedlineCircle)}),this._actionsNullary.set("toolbar-redline-freehand",()=>{this._setRedlineOperator(a.OperatorId.RedlinePolyline)}),this._actionsNullary.set("toolbar-redline-rectangle",()=>{this._setRedlineOperator(a.OperatorId.RedlineRectangle)}),this._actionsNullary.set("toolbar-redline-note",()=>{this._setRedlineOperator(a.OperatorId.RedlineText)}),this._actionsNullary.set("toolbar-note",()=>{t.set(a.OperatorId.Note,1)}),this._actionsNullary.set("toolbar-select",()=>{t.set(a.OperatorId.Select,1)}),this._actionsNullary.set("toolbar-area-select",()=>{t.set(a.OperatorId.AreaSelect,1)}),this._actionsNullary.set("toolbar-orbit",()=>{t.set(a.OperatorId.Navigate,0)}),this._actionsNullary.set("toolbar-turntable",()=>{t.set(a.OperatorId.Turntable,0)}),this._actionsNullary.set("toolbar-walk",()=>{t.set(a.OperatorId.WalkMode,0)}),this._actionsNullary.set("toolbar-face",()=>__awaiter(this,void 0,void 0,function*(){yield this._orientToFace()})),this._actionsNullary.set("toolbar-measure-point",()=>{t.set(a.OperatorId.MeasurePointPointDistance,1)}),this._actionsNullary.set("toolbar-measure-edge",()=>{t.set(a.OperatorId.MeasureEdgeLength,1)}),this._actionsNullary.set("toolbar-measure-distance",()=>{t.set(a.OperatorId.MeasureFaceFaceDistance,1)}),this._actionsNullary.set("toolbar-measure-angle",()=>{t.set(a.OperatorId.MeasureFaceFaceAngle,1)}),this._actionsNullary.set("toolbar-cuttingplane",()=>{}),this._actionsBoolean.set("toolbar-explode",e=>__awaiter(this,void 0,void 0,function*(){yield this._explosionButtonClick(e)})),this._actionsNullary.set("toolbar-settings",()=>__awaiter(this,void 0,void 0,function*(){yield this._settingsButtonClick()})),this._actionsNullary.set("toolbar-wireframeshaded",()=>{this._renderModeClick("toolbar-wireframeshaded")}),this._actionsNullary.set("toolbar-shaded",()=>{this._renderModeClick("toolbar-shaded")}),this._actionsNullary.set("toolbar-wireframe",()=>{this._renderModeClick("toolbar-wireframe")}),this._actionsNullary.set("toolbar-hidden-line",()=>{this._renderModeClick("toolbar-hidden-line")}),this._actionsNullary.set("toolbar-xray",()=>{this._renderModeClick("toolbar-xray")}),this._actionsNullary.set("toolbar-front",()=>__awaiter(this,void 0,void 0,function*(){yield e.setViewOrientation(a.ViewOrientation.Front,this._viewOrientationDuration)})),this._actionsNullary.set("toolbar-back",()=>__awaiter(this,void 0,void 0,function*(){yield e.setViewOrientation(a.ViewOrientation.Back,this._viewOrientationDuration)})),this._actionsNullary.set("toolbar-left",()=>__awaiter(this,void 0,void 0,function*(){yield e.setViewOrientation(a.ViewOrientation.Left,this._viewOrientationDuration)})),this._actionsNullary.set("toolbar-right",()=>__awaiter(this,void 0,void 0,function*(){yield e.setViewOrientation(a.ViewOrientation.Right,this._viewOrientationDuration)})),this._actionsNullary.set("toolbar-bottom",()=>__awaiter(this,void 0,void 0,function*(){yield e.setViewOrientation(a.ViewOrientation.Bottom,this._viewOrientationDuration)})),this._actionsNullary.set("toolbar-top",()=>__awaiter(this,void 0,void 0,function*(){yield e.setViewOrientation(a.ViewOrientation.Top,this._viewOrientationDuration)})),this._actionsNullary.set("toolbar-iso",()=>__awaiter(this,void 0,void 0,function*(){yield e.setViewOrientation(a.ViewOrientation.Iso,this._viewOrientationDuration)})),this._actionsNullary.set("toolbar-ortho",()=>{e.setProjectionMode(a.Projection.Orthographic)}),this._actionsNullary.set("toolbar-persp",()=>{e.setProjectionMode(a.Projection.Perspective)}),this._actionsNullary.set("toolbar-snapshot",()=>__awaiter(this,void 0,void 0,function*(){yield this._doSnapshot()}))}_onExplosionSlider(e){return this._viewer.explodeManager.setMagnitude(e)}_explosionButtonClick(e){var t=this._viewer.explodeManager;return e&&!t.getActive()?t.start():Promise.resolve()}_settingsButtonClick(){return this._viewerSettings.show()}updateEdgeFaceButton(){var e=this._viewer.view,t=e.getLineVisibility(),e=e.getFaceVisibility();t&&e?this.setCorrespondingButtonForSubmenuItem("wireframeshaded"):!t&&e?this.setCorrespondingButtonForSubmenuItem("shaded"):this.setCorrespondingButtonForSubmenuItem("wireframe")}_cuttingPlaneButtonClick(e){e=$(e.target).closest(".toolbar-cp-plane").data("plane");let t;var i=this._getAxis(e);return(t=null!==i?this._cuttingPlaneController.toggle(i):"section"===e?this._cuttingPlaneController.toggleReferenceGeometry():"toggle"===e?this._cuttingPlaneController.toggleCuttingMode():"reset"===e?this._cuttingPlaneController.resetCuttingPlanes():Promise.resolve()).then(()=>{this._updateCuttingPlaneIcons()})}_getAxis(e){switch(e){case"x":return 0;case"y":return 1;case"z":return 2;case"face":return 3;default:return null}}_updateCuttingPlaneIcons(){var e=this._cuttingPlaneController.getReferenceGeometryEnabled(),t=this._cuttingPlaneController.individualCuttingSectionEnabled,i=this._cuttingPlaneController.getCount();this._updateCuttingPlaneIcon(0,this._cuttingPlaneXSelector),this._updateCuttingPlaneIcon(1,this._cuttingPlaneYSelector),this._updateCuttingPlaneIcon(2,this._cuttingPlaneZSelector),this._updateCuttingPlaneIcon(3,this._cuttingPlaneFaceSelector),t?$(this._cuttingPlaneGroupToggle).removeClass(this._selectedClass):$(this._cuttingPlaneGroupToggle).addClass(this._selectedClass),0<i?(e?$(this._cuttingPlaneVisibilitySelector).removeClass(this._selectedClass):$(this._cuttingPlaneVisibilitySelector).addClass(this._selectedClass),$(this._cuttingPlaneVisibilitySelector).removeClass(this._disabledClass),$(this._cuttingPlaneResetSelector).removeClass(this._disabledClass)):($(this._cuttingPlaneVisibilitySelector).addClass(this._disabledClass),$(this._cuttingPlaneResetSelector).addClass(this._disabledClass)),1<i?$(this._cuttingPlaneGroupToggle).removeClass(this._disabledClass):$(this._cuttingPlaneGroupToggle).addClass(this._disabledClass)}_updateCuttingPlaneIcon(e,t){t=$(t),t.removeClass(this._selectedClass),t.removeClass(this._invertedClass),e=this._cuttingPlaneController.getPlaneStatus(e);1===e?t.addClass(this._selectedClass):2===e&&t.addClass(this._invertedClass)}_orientToFace(){var t=this._viewer.selectionManager.getLast();if(null!==t&&t.isFaceSelection()){var i=this._viewer.view,s=t.getFaceEntity().getNormal(),r=t.getPosition(),o=i.getCamera();let e=a.Point3.cross(s,new a.Point3(0,1,0));e.length()<.001&&(e=a.Point3.cross(s,new a.Point3(1,0,0)));var n=o.getPosition().subtract(o.getTarget()).length();return o.setTarget(r),o.setPosition(a.Point3.add(r,a.Point3.scale(s,n))),o.setUp(e),i.fitBounding(t.getFaceEntity().getBounding(),a.DefaultTransitionDuration,o)}return Promise.resolve()}}}(Communicator=Communicator||{}),function(i){var a;(a=i.Ui||(i.Ui={})).ColorPicker=class{constructor(e,t){this._colorPickerId="colorPicker",this._colorPickerHeaderId="colorPickerHeader",this._colorPickerFooterId="colorPickerFooter",this._colorPickerOkId="colorPickerOk",this._colorPickerCancelId="colorPickerCancel",this._colorPickerApplyId="colorPickerApply",this._colorPickerInputId="colorPickerInput",this._colorPickerActiveColorId="colorPickerActiveColor",this._colorPickerActiveColorLabelId="colorPickerActiveColorLabel",this._colorPickerActiveColorSwatchId="colorPickerActiveColorSwatch",this._color=i.Color.black(),this._viewer=e,this._colorPicker=this._createColorPickerWindow(t),this._initElements()}_createColorPickerWindow(e){var t=document.createElement("div"),i=(t.id=this._colorPickerId,t.classList.add("desktop-ui-window"),document.createElement("div")),s=(i.id=this._colorPickerHeaderId,i.classList.add("desktop-ui-window-header"),i.innerHTML="Color Picker",document.createElement("div")),r=(s.classList.add("desktop-ui-window-content"),document.createElement("div")),o=(r.id=this._colorPickerActiveColorId,s.appendChild(r),document.createElement("span")),o=(o.id=this._colorPickerActiveColorLabelId,o.innerHTML="Active Color:",r.appendChild(o),document.createElement("span")),r=(o.id=this._colorPickerActiveColorSwatchId,o.style.backgroundColor=a.cssHexStringFromColor(this._color),r.appendChild(o),document.createElement("input")),o=(r.id=this._colorPickerInputId,r.type="text",r.classList.add("color-picker"),s.appendChild(r),document.createElement("div")),n=(o.id=this._colorPickerFooterId,o.classList.add("desktop-ui-window-footer"),document.createElement("button")),n=(n.id=this._colorPickerOkId,n.innerHTML="Ok",o.appendChild(n),document.createElement("button")),n=(n.id=this._colorPickerCancelId,n.innerHTML="Cancel",o.appendChild(n),document.createElement("button"));return n.id=this._colorPickerApplyId,n.innerHTML="Apply",o.appendChild(n),t.appendChild(i),t.appendChild(s),t.appendChild(o),$("#"+e).append(t),$(r).minicolors({position:"bottom left",format:"rgb",control:"hue",defaultValue:a.rgbStringFromColor(this._color),inline:!0}),$(t)}_initElements(){this._colorPicker.draggable({handle:"#"+this._colorPickerHeaderId}),$("#"+this._colorPickerOkId).on("click",()=>{this._updateColor(),this.hide()}),$("#"+this._colorPickerCancelId).on("click",()=>{this.hide()}),$("#"+this._colorPickerApplyId).on("click",()=>{this._updateColor()})}_updateColor(){this._color.assign(a.colorFromRgbString(a.getValueAsString("#"+this._colorPickerInputId))),$("#"+this._colorPickerActiveColorSwatchId).css("background",a.cssHexStringFromColor(this._color))}show(){a.centerWindow(this._colorPickerId,this._viewer.view.getCanvasSize()),this._colorPicker.show()}hide(){this._colorPicker.hide()}getColor(){return this._color.copy()}}}(Communicator=Communicator||{}),function(n){var e,r=n.Ui||(n.Ui={});{var a=r.Desktop||(r.Desktop={});let o;(e=o=a.Tree||(a.Tree={}))[e.Model=0]="Model",e[e.CadView=1]="CadView",e[e.Sheets=2]="Sheets",e[e.Configurations=3]="Configurations",e[e.Layers=4]="Layers",e[e.Filters=5]="Filters",e[e.Types=6]="Types",e[e.BCF=7]="BCF",e[e.Relationships=8]="Relationships",a.ModelBrowser=class{constructor(e,t,i,s,r){this._treeMap=new Map,this._scrollTreeMap=new Map,this._elementIdMap=new Map,this._browserWindowMargin=3,this._scrollRefreshTimer=new n.Util.Timer,this._scrollRefreshTimestamp=0,this._scrollRefreshInterval=300,this._minimized=!0,this._modelHasRelationships=!1,this._elementId=e,this._containerId=t,this._viewer=i,this._isolateZoomHelper=s,this._colorPicker=r,this._canvasSize=this._viewer.view.getCanvasSize(),this._header=this._createHeader(),this._browserWindow=this._createBrowserWindow(),this._createPropertyWindow(),$(this._browserWindow).resizable({resize:(e,t)=>{this.onResize(t.size.height)},minWidth:35,minHeight:37,handles:"e"}),this._elementIdMap.set(o.Model,"modelTree"),this._elementIdMap.set(o.CadView,"cadViewTree"),this._elementIdMap.set(o.Sheets,"sheetsTree"),this._elementIdMap.set(o.Configurations,"configurationsTree"),this._elementIdMap.set(o.Layers,"layersTree"),this._elementIdMap.set(o.Filters,"filtersTree"),this._elementIdMap.set(o.Types,"typesTree"),this._elementIdMap.set(o.BCF,"bcfTree"),this._elementIdMap.forEach((e,t)=>{this._addTree(e,t)}),this._contextMenu=new a.ModelBrowserContextMenu(this._containerId,this._viewer,this._treeMap,this._isolateZoomHelper,this._colorPicker),this._initEvents(),this._minimizeModelBrowser()}_computeRelationshipTreeVisibility(e){for(const i of e){var t=this._viewer.model._getModelStructure().hasRelationships(i);if(!this._modelHasRelationships&&t)return this._modelHasRelationships=!0,void this._updateRelationshipsTreeVisibility()}}_initEvents(){const i=e=>{this._showTree(o.Model),this._computeRelationshipTreeVisibility(e)};this._viewer.setCallbacks({modelStructureLoadBegin:()=>{this._onModelStructureLoadBegin()},modelStructureParseBegin:()=>{this._onModelStructureParsingBegin()},assemblyTreeReady:()=>{this._onAssemblyTreeReady()},firstModelLoaded:i,modelSwitched:(e,t)=>{i(t)},frameDrawn:()=>{this._canvasSize=this._viewer.view.getCanvasSize(),this.onResize(this._canvasSize.y)},subtreeLoaded:e=>{this._computeRelationshipTreeVisibility(e)}}),this._registerScrollRefreshCallbacks(),$("#contextMenuButton").on("click",e=>{e=new n.Point2(e.clientX,e.clientY);this._viewer.trigger("contextMenu",e,n.KeyModifiers.None)})}_registerScrollRefreshCallbacks(){this._treeMap.forEach(e=>{e instanceof r.ViewTree&&(e.registerCallback("expand",()=>{this._refreshBrowserScroll()}),e.registerCallback("collapse",()=>{this._refreshBrowserScroll()}),e.registerCallback("addChild",()=>{this._refreshBrowserScroll()}))}),this._relationshipTree.registerCallback("expand",()=>{this._refreshBrowserScroll()}),this._relationshipTree.registerCallback("collapse",()=>{this._refreshBrowserScroll()}),this._relationshipTree.registerCallback("addChild",()=>{this._refreshBrowserScroll()})}_refreshBrowserScroll(){const e=++this._scrollRefreshTimestamp;this._scrollRefreshTimer.isIdle(0)&&this._scrollRefreshTimer.set(this._scrollRefreshInterval,()=>{this._scrollTreeMap.forEach(e=>{e.refresh()}),e!==this._scrollRefreshTimestamp&&this._refreshBrowserScroll()})}_setPropertyWindowVisibility(e){e?this._propertyWindow.classList.remove("hidden"):this._propertyWindow.classList.add("hidden"),this.onResize(this._viewer.view.getCanvasSize().y)}_updateRelationshipsTreeVisibility(){this._setRelationshipsWindowVisibility(this._modelHasRelationships)}_setRelationshipsWindowVisibility(e){e?this._relationshipsWindow.classList.remove("hidden"):this._relationshipsWindow.classList.add("hidden"),this.onResize(this._viewer.view.getCanvasSize().y)}_setTreeVisibility(e,t){var i=e.getElementId(),s=$(`#${i}ScrollContainer`),i=$(`#${i}Tab`);t?(s.show(),i.addClass("browser-tab-selected"),e instanceof r.BCFTree?(this._setPropertyWindowVisibility(!1),this._setRelationshipsWindowVisibility(!1)):(this._setPropertyWindowVisibility(!0),this._updateRelationshipsTreeVisibility())):(s.hide(),i&&i.removeClass("browser-tab-selected"))}_showTree(i){this._treeMap.forEach((e,t)=>{this._setTreeVisibility(e,t===i)}),this._refreshBrowserScroll()}_getContextMenu(){return this._contextMenu}_addTree(e,t){var i=this._initializeIScroll(e);this._scrollTreeMap.set(t,i);let s;t===o.Model?s=new r.ModelTree(this._viewer,e,i):t===o.CadView?s=new r.CadViewTree(this._viewer,e,i):t===o.Sheets?s=new r.SheetsTree(this._viewer,e,i):t===o.Configurations?s=new r.ConfigurationsTree(this._viewer,e,i):t===o.Layers?s=new r.LayersTree(this._viewer,e,i):t===o.Filters?s=new r.FiltersTree(this._viewer,e,i):t===o.Types?s=new r.TypesTree(this._viewer,e,i):t===o.BCF?s=new r.BCFTree(this._viewer,e,i):t===o.Relationships?s=new r.RelationshipsTree(this._viewer,e,i):n.Util.TypeAssertNever(t),this._treeMap.set(t,s)}_createBrowserWindow(){var e=document.getElementById(this._elementId),t=($(e).on("touchmove",e=>{e.originalEvent&&e.originalEvent.preventDefault()}),e.classList.add("ui-modelbrowser-window"),e.classList.add("desktop-ui-window"),e.classList.add("ui-modelbrowser-small"),e.style.position="absolute",$(window).width());return void 0!==t&&(e.style.width=Math.max(t/4,400)+"px"),e.style.top=this._browserWindowMargin+"px",e.style.left=this._browserWindowMargin+"px",e.appendChild(this._header),e}_createDiv(e,t){var i=document.createElement("div");i.id=e;for(const s of t)i.classList.add(s);return i}_createHeader(){var e=this._createDiv("ui-modelbrowser-header",["ui-modelbrowser-header","desktop-ui-window-header"]),t=document.createElement("table"),i=document.createElement("tr"),s=(t.appendChild(i),document.createElement("td")),s=(s.classList.add("ui-modelbrowser-minimizetd"),this._minimizeButton=this._createDiv("ui-modelbrowser-minimizebutton",["ui-modelbrowser-minimizebutton","minimized"]),this._minimizeButton.onclick=()=>{this._onMinimizeButtonClick()},s.appendChild(this._minimizeButton),i.appendChild(s),document.createElement("td")),s=(s.id="modelBrowserLabel",s.innerHTML="",i.appendChild(s),this._createDiv("contextMenuButton",["ui-modeltree-icon","menu"])),i=(i.appendChild(s),e.appendChild(t),this._content=this._createDiv("modelTreeContainer",["ui-modelbrowser-content","desktop-ui-window-content"]),this._content.style.overflow="auto",this._createDiv("modelBrowserLoadingDiv",[]));return i.innerHTML="Loading...",this._content.appendChild(i),this._createIScrollWrapper(this._content,"modelTree"),this._createIScrollWrapper(this._content,"cadViewTree"),this._createIScrollWrapper(this._content,"sheetsTree"),this._createIScrollWrapper(this._content,"configurationsTree"),this._createIScrollWrapper(this._content,"layersTree"),this._createIScrollWrapper(this._content,"filtersTree"),this._createIScrollWrapper(this._content,"typesTree"),this._createIScrollWrapper(this._content,"bcfTree"),this._modelBrowserTabs=this._createDiv("modelBrowserTabs",[]),this._createBrowserTab("modelTreeTab","Model Tree",!0,o.Model),this._createBrowserTab("cadViewTreeTab","Views",!1,o.CadView),this._createBrowserTab("sheetsTreeTab","Sheets",!1,o.Sheets),this._createBrowserTab("configurationsTreeTab","Configurations",!1,o.Configurations),this._createBrowserTab("layersTreeTab","Layers",!1,o.Layers),this._createBrowserTab("relationTreeTab","Relations",!1,o.Relationships),this._createBrowserTab("filtersTreeTab","Filters",!1,o.Filters),this._createBrowserTab("typesTreeTab","Types",!1,o.Types),this._createBrowserTab("bcfTreeTab","BCF",!1,o.BCF),e.appendChild(this._modelBrowserTabs),e}_createIScrollWrapper(e,t){var i=this._createDiv(t+"ScrollContainer",[]);i.classList.add("tree-scroll-container"),i.appendChild(this._createDiv(t,[])),e.appendChild(i)}_createBrowserTab(e,t,i,s){var r=document.createElement("label");return r.id=e,r.textContent=t,r.classList.add("ui-modelbrowser-tab"),r.classList.add("hidden"),i&&r.classList.add("browser-tab-selected"),r.onclick=e=>{this._showTree(s)},this._modelBrowserTabs.appendChild(r),r}_initializeIScroll(e){e=$(`#${e}ScrollContainer`).get(0);return new IScroll(e,{mouseWheel:!0,scrollbars:!0,interactiveScrollbars:!0,preventDefault:!1})}_createRelationshipTree(e){this._createIScrollWrapper(e,"relationshipsTree");e=this._initializeIScroll("relationshipsTree"),this._scrollTreeMap.set(o.Relationships,e),e=new r.RelationshipsTree(this._viewer,"relationshipsTree",e);return this._setTreeVisibility(e,!0),e}_createPropertyWindow(){this._propertyWindow=document.createElement("div"),this._propertyWindow.classList.add("propertyWindow"),this._propertyWindow.id="propertyWindow";var e=document.createElement("div");e.id="propertyContainer",this._propertyWindow.appendChild(e),this._treePropertyContainer=document.createElement("div"),this._treePropertyContainer.id="treePropertyContainer",this._relationshipsWindow=document.createElement("div"),this._relationshipsWindow.classList.add("relationshipsWindow","hidden"),this._relationshipsWindow.id="relationshipsWindow",this._treePropertyContainer.appendChild(this._content),this._treePropertyContainer.appendChild(this._relationshipsWindow),this._treePropertyContainer.appendChild(this._propertyWindow),this._browserWindow.appendChild(this._treePropertyContainer),this._relationshipTree=this._createRelationshipTree(this._relationshipsWindow),$(this._propertyWindow).resizable({resize:()=>{this.onResizeElement(this._viewer.view.getCanvasSize().y,this._relationshipsWindow)},handles:"n"}),$(this._relationshipsWindow).resizable({resize:()=>{this.onResizeElement(this._viewer.view.getCanvasSize().y,this._content)},handles:"n"})}_onMinimizeButtonClick(){this._minimized?this._maximizeModelBrowser():this._minimizeModelBrowser()}_maximizeModelBrowser(){this._minimized=!1,this.freeze(!1);var e=jQuery(this._minimizeButton);e.addClass("maximized"),e.removeClass("minimized"),jQuery(this._content).slideDown({progress:()=>{this._onSlide(),$("#modelBrowserWindow").removeClass("ui-modelbrowser-small")},complete:()=>{$(this._browserWindow).children(".ui-resizable-handle").show()},duration:r.DefaultUiTransitionDuration}),this._refreshBrowserScroll()}_minimizeModelBrowser(){this._minimized=!0,this.freeze(!0);var e=jQuery(this._minimizeButton);e.removeClass("maximized"),e.addClass("minimized"),jQuery(this._content).slideUp({progress:()=>{this._onSlide(),$("#modelBrowserWindow").addClass("ui-modelbrowser-small")},complete:()=>{$(this._browserWindow).children(".ui-resizable-handle").hide()},duration:r.DefaultUiTransitionDuration}),this._refreshBrowserScroll()}onResize(e){var t=$(this._header).outerHeight(),i=$(this._propertyWindow).outerHeight(),s=$(this._relationshipsWindow).outerHeight();void 0!==t&&void 0!==i&&void 0!==s&&(this._treePropertyContainer.style.height=e-t-2*this._browserWindowMargin+"px",t=e-t-i-s-2*this._browserWindowMargin,this._browserWindow.style.height=e-2*this._browserWindowMargin+"px",this._content.style.height=t+"px",this._refreshBrowserScroll())}onResizeElement(t,i){var s=$(this._header).outerHeight(),r=$(this._content).outerHeight(),o=$(this._propertyWindow).outerHeight(),n=$(this._relationshipsWindow).outerHeight(),a=($(i).hasClass("hidden")&&(i=this._content),$(i).outerHeight()),l=$(i).height();if(void 0!==s&&void 0!==o&&void 0!==n&&void 0!==r&&void 0!==a&&void 0!==l){this._treePropertyContainer.style.height=t-s-2*this._browserWindowMargin+"px";let e=t-s-o-n-r+a-2*this._browserWindowMargin-(a-l);e<0&&(e=0),this._browserWindow.style.height=t-2*this._browserWindowMargin+"px",i.style.height=e+"px",this._refreshBrowserScroll()}}_onSlide(){var e=$(this._header).outerHeight(),t=$(this._content).outerHeight(),i=$(this._propertyWindow).outerHeight(),s=$(this._relationshipsWindow).outerHeight();void 0!==e&&void 0!==t&&void 0!==i&&void 0!==s&&(this._browserWindow.style.height=t+e+i+s+"px")}_onModelStructureParsingBegin(){$("#modelBrowserLoadingDiv").html("Parsing...")}_onModelStructureLoadBegin(){$("#"+this._elementId).show()}_onAssemblyTreeReady(){$("#modelBrowserLoadingDiv").remove(),this._showTree(o.Model);var e=$(this._elementId).height();void 0!==e&&this.onResize(e)}freeze(e){this._getTree(o.Model).freezeExpansion(e)}enablePartSelection(e){this._getTree(o.Model).enablePartSelection(e)}updateSelection(e){this._getTree(o.Model).updateSelection(e)}_getTree(e){return this._treeMap.get(e)}}}}(Communicator=Communicator||{}),function(n){var e,a=n.Ui||(n.Ui={});{var l=a.Desktop||(a.Desktop={});let o;(e=o=o||{})[e.Generic=0]="Generic",e[e.Bim=1]="Bim",e[e.Drawing=2]="Drawing";class t{constructor(e,t){if(this._modelBrowser=null,this._toolbar=null,this._modelType=o.Generic,this._uiModelType=null,this._suppressMissingModelDialog=!1,this._viewer=e,this._params=Object.assign({},t),void 0===this._params.containerId)throw new n.ParseError("Must supply 'containerId'.");this._colorPicker=new a.ColorPicker(this._viewer,this._params.containerId);var i,e=this._getWithDefault(this._params.screenConfiguration,n.ScreenConfiguration.Desktop),t=this._getWithDefault(this._params.showModelBrowser,!0),s=this._getWithDefault(this._params.showToolbar,!0),r=(e===n.ScreenConfiguration.Mobile&&(i=(r=this._viewer.view).getAxisTriad(),r=r.getNavCube(),i.setAnchor(n.OverlayAnchor.UpperRightCorner),r.setAnchor(n.OverlayAnchor.UpperLeftCorner),$("body").addClass("mobile"),i=this._viewer.operatorManager.getOperator(n.OperatorId.Handle))&&i.setHandleSize(3),this._cuttingPlaneController=new a.CuttingPlane.Controller(this._viewer),this._isolateZoomHelper=new n.IsolateZoomHelper(this._viewer),s&&(this._toolbar=new a.Toolbar(this._viewer,this._cuttingPlaneController,e),this._toolbar.init()),document.getElementById("content")),s=(r.oncontextmenu=()=>!1,t&&((i=document.createElement("div")).id="modelBrowserWindow",r.appendChild(i),this._modelBrowser=new l.ModelBrowser(i.id,r.id,this._viewer,this._isolateZoomHelper,this._colorPicker)),new l.PropertyWindow(this._viewer),document.createElement("div"));s.id="streamingIndicator",r.appendChild(s),this._viewer.getRendererType()===n.RendererType.Client&&new a.StreamingIndicator(s.id,this._viewer),this._contextMenu=new a.RightClickContextMenu(r.id,this._viewer,this._isolateZoomHelper,this._colorPicker),new a.TimeoutWarningDialog(r.id,this._viewer),this._viewer.setCallbacks({sceneReady:()=>{this._onSceneReady()},firstModelLoaded:e=>{this._modelType=this._determineModelType(e),this._configureUi(this._modelType)},modelSwitched:e=>{e&&(this._modelType=o.Generic,this._configureUi(this._modelType))},sheetActivated:()=>{this._configureUi(o.Drawing)},sheetDeactivated:()=>{this._configureUi(this._modelType)},modelLoadFailure:(t,i)=>{if(!this._suppressMissingModelDialog){var s=new a.UiDialog("content");s.setTitle("Model Load Error");let e="Unable to load ";e=e+(t?`'${t}'`:"model")+(": "+i),s.setText(e),s.show()}},modelLoadBegin:()=>{this._suppressMissingModelDialog=!1},missingModel:e=>{var t,i;this._suppressMissingModelDialog||(this._suppressMissingModelDialog=!0,(t=new a.UiDialog("content")).setTitle("Missing Model Error"),i="Unable to load ",t.setText(i+=`'${e}'`),t.show())},webGlContextLost:()=>{var e=new a.UiDialog("content");e.setTitle("Fatal Error"),e.setText("WebGL context lost. Rendering cannot continue."),e.show()},XHRonloadend:(e,t,i)=>{404===t&&((t=new a.UiDialog("content")).setTitle("404 Error"),t.setText("Unable to load "+i),t.show())},incrementalSelectionBatchBegin:()=>{this.freezeModelBrowser(!0),this.enableModelBrowserPartSelection(!1)},incrementalSelectionBatchEnd:()=>{this.freezeModelBrowser(!1),this.enableModelBrowserPartSelection(!0)},incrementalSelectionEnd:()=>{null!==this._modelBrowser&&this._modelBrowser.updateSelection(null)}})}_getWithDefault(e,t){return void 0===e?t:e}_determineModelType(e){let t=o.Generic;return this._viewer.sheetManager.isDrawingSheetActive()?t=o.Drawing:this._isBim(e)&&(t=o.Bim),t}_isBim(e){if(0<e.length){e=e[0],e=this._viewer.model.getModelFileTypeFromNode(e);if(e===n.FileType.Ifc||e===n.FileType.Revit)return!0}return!1}_configureUi(e){var t,i;this._uiModelType!==e&&(this._uiModelType=e,t=this._viewer.view.getAxisTriad(),i=this._viewer.view.getNavCube(),e===o.Drawing?(t.disable(),i.disable(),this._viewer.view.setDrawMode(n.DrawMode.WireframeOnShaded)):(t.enable(),e===o.Bim?this._viewer.view.setBackfacesVisible(!0):i.enable()),this._configureToolbar(e),this._configureModelBrowser(e))}_configureToolbar(e){null!==this._toolbar&&(e===o.Drawing?($("#cuttingplane-button").hide(),$("#cuttingplane-submenu").hide(),$("#explode-button").hide(),$("#explode-slider").hide(),$("#explode-submenu").hide(),$("#view-button").hide(),$("#view-submenu").hide(),$("#camera-button").hide(),$("#camera-submenu").hide(),$("#tool_separator_4").hide(),$("#tool_separator_1").hide(),$("#edgeface-button").hide(),$("#edgeface-submenu").hide()):($("#cuttingplane-button").show(),$("#explode-button").show(),$("#view-button").show(),$("#camera-button").show(),$("#tool_separator_4").show(),$("#tool_separator_1").show(),$("#edgeface-button").show()),this._toolbar.reposition())}_configureModelBrowser(e){null!==this._modelBrowser&&(e===o.Drawing?$(".ui-modeltree").addClass("drawing"):$(".ui-modeltree").removeClass("drawing"))}_onSceneReady(){this._viewer.focusInput(!0);var e=this._viewer.selectionManager,e=(e.setNodeSelectionColor(t._defaultPartSelectionColor),e.setNodeSelectionOutlineColor(t._defaultPartSelectionOutlineColor),this._viewer.view);e.setXRayColor(n.ElementType.Faces,t._defaultXRayColor),e.setXRayColor(n.ElementType.Lines,t._defaultXRayColor),e.setXRayColor(n.ElementType.Points,t._defaultXRayColor),e.setBackgroundColor(t._defaultBackgroundColor,t._defaultBackgroundColor),this._viewer.getViewElement().addEventListener("mouseenter",()=>{this._viewer.focusInput(!0)})}setDeselectOnIsolate(e){this._isolateZoomHelper.setDeselectOnIsolate(e)}freezeModelBrowser(e){null!==this._modelBrowser&&this._modelBrowser.freeze(e)}enableModelBrowserPartSelection(e){null!==this._modelBrowser&&this._modelBrowser.enablePartSelection(e)}_getContextMenu(){return this._contextMenu}_getModelBrowser(){return this._modelBrowser}_getToolbar(){return this._toolbar}}t._defaultBackgroundColor=n.Color.white(),t._defaultPartSelectionColor=n.Color.createFromFloat(0,.8,0),t._defaultPartSelectionOutlineColor=n.Color.createFromFloat(0,.8,0),t._defaultXRayColor=n.Color.createFromFloat(0,.9,0),l.DesktopUi=t}}(Communicator=Communicator||{}),function(e){var r=e.Ui||(e.Ui={});{var t=r.Desktop||(r.Desktop={});class i extends r.Context.ContextMenu{constructor(e,t,i,s,r){super("modelbrowser",e,t,s,r),this._treeMap=i,this._initEvents()}_initEvents(){return __awaiter(this,void 0,void 0,function*(){yield this._registerContextMenuCallback(t.Tree.Model),yield this._registerContextMenuCallback(t.Tree.Layers),yield this._registerContextMenuCallback(t.Tree.Types),this._viewer.getStreamingMode()===e.StreamingMode.OnDemand&&(this.appendSeparator(),this.appendItem("request","Request",()=>__awaiter(this,void 0,void 0,function*(){yield this._viewer.model.requestNodes(this.getContextItemIds(!1,!0))})))})}_registerContextMenuCallback(t){return __awaiter(this,void 0,void 0,function*(){var e=this._treeMap.get(t);void 0!==e&&e instanceof r.ViewTree&&e.registerCallback("context",(e,t)=>__awaiter(this,void 0,void 0,function*(){yield this._onTreeContext(e,t)}))})}_onTreeContext(i,s){return __awaiter(this,void 0,void 0,function*(){var e=i.split(r.ModelTree.separator);switch(e[0]){case"layer":yield this.setActiveLayerName(i);break;case"types":yield this.setActiveType(e[1]);break;case"typespart":case"layerpart":case"part":var t=parseInt(e[1],10);yield this.setActiveItemId(t);break;default:return}this._position=null,this.showElements(s)})}_onContextLayerClick(e){this.hide()}}t.ModelBrowserContextMenu=i}}(Communicator=Communicator||{}),function(e){function u(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}((e=e.Ui||(e.Ui={})).Desktop||(e.Desktop={})).PropertyWindow=class{constructor(e){this._assemblyTreeReadyOccurred=!1,this._incrementalSelectionActive=!1,this._viewer=e,this._propertyWindow=$("#propertyContainer");e=()=>__awaiter(this,void 0,void 0,function*(){this._update()});this._viewer.setCallbacks({assemblyTreeReady:()=>{this._onModelStructureReady()},firstModelLoaded:e,modelSwitched:e,selectionArray:e=>__awaiter(this,void 0,void 0,function*(){0<e.length&&(yield this._onPartSelection(e[e.length-1]))}),incrementalSelectionBatchBegin:()=>{this._incrementalSelectionActive=!0},incrementalSelectionBatchEnd:()=>{this._incrementalSelectionActive=!1}})}_update(e="&lt;no properties to display&gt;"){this._propertyWindow.html(e)}_onModelStructureReady(){this._assemblyTreeReadyOccurred=!0,this._update()}_createRow(e,t,i=""){var s=document.createElement("tr"),i=(s.id=`propertyTableRow_${e}_`+t,0<i.length&&s.classList.add(i),document.createElement("td")),e=(i.id="propertyDiv_"+e,i.innerHTML=e,document.createElement("td"));return e.id="propertyDiv_"+t,e.innerHTML=t,s.appendChild(i),s.appendChild(e),s}_onPartSelection(e){return __awaiter(this,void 0,void 0,function*(){if(this._assemblyTreeReadyOccurred&&!this._incrementalSelectionActive){this._update();var i=this._viewer.model,s=e.getSelection().getNodeId();if(null!==s&&i.isNodeLoaded(s)){var r=i.getNodeName(s);let e=null,t=null;var o,n=yield i.getNodeProperties(s);if(null!==n&&0<(o=Object.keys(n)).length){(e=document.createElement("table")).id="propertyTable",e.appendChild(this._createRow("Property","Value","headerRow")),e.appendChild(this._createRow("Name",null!==r?r:"unnamed"));for(const c of o){var a=u(c),l=u(n[c]);e.appendChild(this._createRow(a,l))}}r=i.getNodeUserDataIndices(s);if(0<r.length){(t=document.createElement("table")).id="propertyTable",t.appendChild(this._createRow("User Data Index","User Data Size","headerRow"));for(const _ of r){var d=i.getNodeUserData(s,_),h="number"==typeof _?"0x"+_.toString(16).toUpperCase():"0x"+_,d=""+d.length;t.appendChild(this._createRow(h,d))}}null===e&&null===t||(this._update(""),null!==e&&this._propertyWindow.append(e),null!==t&&this._propertyWindow.append(t))}}})}}}(Communicator=Communicator||{}),function(t){var e;(e=t.Ui||(t.Ui={})).DefaultUiTransitionDuration=400,e.colorFromRgbString=function(e){return e=e.replace(/[^\d,]/g,"").split(","),new t.Color(Number(e[0]),Number(e[1]),Number(e[2]))},e.rgbStringFromColor=function(e){return e?`rgb(${Math.round(e.r)},${Math.round(e.g)},${Math.round(e.b)})`:""},e.cssHexStringFromColor=function(e){var t=e=>{e=e.toString(16);return 1===e.length?"0"+e:e};return"#"+t(e.r)+t(e.g)+t(e.b)},e.getValueAsString=function(e){return"string"==typeof(e=$(e).val())?e:""},e.centerWindow=function(e,t){var i=(e=$("#"+e)).width(),s=e.height();void 0!==i&&void 0!==s&&(i=(t.x-i)/2,t=(t.y-s)/2,e.css({left:i+"px",top:t+"px"}))}}(Communicator=Communicator||{}),function(N){var e,E=N.Ui||(N.Ui={});{var t=E.Desktop||(E.Desktop={});let d;(e=d=t.SettingTab||(t.SettingTab={}))[e.General=0]="General",e[e.Walk=1]="Walk",e[e.Drawing=2]="Drawing",e[e.Floorplan=3]="Floorplan",t.ViewerSettings=class{constructor(e){this._versionInfo=!0,this._splatRenderingEnabled=!1,this._splatRenderingSize=.003,this._splatRenderingPointSizeUnit=N.PointSizeUnit.ProportionOfBoundingDiagonal,this._floorplanActive=!1,this._honorSceneVisibility=!0,this._walkSpeedUnits=1,this._generalTabLabelId="#settings-tab-label-general",this._walkTabLabelId="#settings-tab-label-walk",this._drawingTabLabelId="#settings-tab-label-drawing",this._floorplanTabLabelId="#settings-tab-label-floorplan",this._generalTabId="#settings-tab-general",this._walkTabId="#settings-tab-walk",this._drawingTabId="#settings-tab-drawing",this._floorplanTabId="#settings-tab-floorplan",this._walkKeyIdsMap=new Map,this._viewer=e;e=this._viewer.view;this._navCube=e.getNavCube(),this._axisTriad=e.getAxisTriad(),this._viewerSettingsSelector="viewer-settings-dialog",this._initElements()}show(){var e=this._updateSettings();return document.body.classList.contains("mobile")&&this._scaleForMobile(),E.centerWindow(this._viewerSettingsSelector,this._viewer.view.getCanvasSize()),$("#"+this._viewerSettingsSelector).show(),e}hide(){$("#"+this._viewerSettingsSelector).hide()}_scaleForMobile(){var e,t=$("#"+this._viewerSettingsSelector),i=$(`#${this._viewerSettingsSelector} .hoops-ui-window-body`),s=this._viewer.view.getCanvasSize(),r=t.width(),r=(void 0!==r&&1.8*r>s.x&&i.css("width",s.x/1.8),t.height());void 0!==r&&1.8*r>s.y&&(t.show(),r=$(`#${this._viewerSettingsSelector} .hoops-ui-window-header`).get(0).offsetHeight,e=$(`#${this._viewerSettingsSelector} .hoops-ui-window-footer`).get(0).offsetHeight,t.hide(),i.css("height",s.y/1.8-1.4*(r+e)))}_initElements(){this._walkKeyIdsMap.set(N.WalkDirection.Up,"walk-key-up"),this._walkKeyIdsMap.set(N.WalkDirection.Down,"walk-key-down"),this._walkKeyIdsMap.set(N.WalkDirection.Left,"walk-key-left"),this._walkKeyIdsMap.set(N.WalkDirection.Right,"walk-key-right"),this._walkKeyIdsMap.set(N.WalkDirection.Forward,"walk-key-forward"),this._walkKeyIdsMap.set(N.WalkDirection.Backward,"walk-key-backward"),this._walkKeyIdsMap.set(N.WalkDirection.TiltUp,"walk-key-tilt-up"),this._walkKeyIdsMap.set(N.WalkDirection.TiltDown,"walk-key-tilt-down"),this._walkKeyIdsMap.set(N.WalkDirection.RotateLeft,"walk-key-rotate-left"),this._walkKeyIdsMap.set(N.WalkDirection.RotateRight,"walk-key-rotate-right"),$("#viewer-settings-dialog").draggable({handle:".hoops-ui-window-header"}),$("INPUT.color-picker").each(function(){$(this).minicolors({position:$(this).attr("data-position")||"bottom left",format:"rgb",control:"hue"})}),$("#viewer-settings-ok-button").on("click",()=>__awaiter(this,void 0,void 0,function*(){yield this._applySettings(),this.hide()})),$("#viewer-settings-cancel-button").on("click",()=>{this.hide()}),$("#viewer-settings-apply-button").on("click",()=>__awaiter(this,void 0,void 0,function*(){yield this._applySettings()})),$("#settings-pmi-enabled").on("click",()=>{this._updateEnabledStyle("settings-pmi-enabled",["settings-pmi-color-style"],["settings-pmi-color"],$("#settings-pmi-enabled").prop("checked"))}),$("#settings-splat-rendering-enabled").on("click",()=>{this._updateEnabledStyle("settings-splat-rendering-enabled",["settings-splat-enabled-style"],["settings-splat-rendering-size","settings-splat-rendering-point-size-unit"],$("#settings-splat-rendering-enabled").prop("checked"))}),$("#settings-mouse-look-enabled").on("click",()=>{this._updateEnabledStyle("settings-mouse-look-enabled",["settings-mouse-look-style"],["settings-mouse-look-speed"],$("#settings-mouse-look-enabled").prop("checked"))}),$("#settings-bim-mode-enabled").on("click",()=>{this._updateEnabledStyle("settings-bim-mode-enabled",[],[],$("#settings-bim-mode-enabled").prop("checked"))}),$("#settings-bloom-enabled").on("click",()=>{this._updateEnabledStyle("settings-bloom-enabled",["settings-bloom-style"],["settings-bloom-intensity","settings-bloom-threshold"],$("#settings-bloom-enabled").prop("checked"))}),$("#settings-shadow-enabled").on("click",()=>{this._updateEnabledStyle("settings-shadow-enabled",["settings-shadow-style"],["settings-shadow-blur-samples","settings-shadow-interactive"],$("#settings-shadow-enabled").prop("checked"))});const e="settings-silhouette-enabled";$("#"+e).on("click",()=>{this._updateEnabledStyle(e,[],[],$("#"+e).prop("checked"))}),this._viewer.setCallbacks({firstModelLoaded:()=>__awaiter(this,void 0,void 0,function*(){var e=this._viewer.operatorManager.getOperator(N.OperatorId.KeyboardWalk);e.getWalkSpeed()<=0&&(yield e.resetDefaultWalkSpeeds(),this._updateWalkSettingsHelper())}),modelSwitchStart:()=>{this._honorSceneVisibility=!0}}),$("#settings-walk-mode").on("change",()=>{var e=parseInt(E.getValueAsString("#settings-walk-mode"),10);this._updateKeyboardWalkModeStyle(e)}),$(this._generalTabLabelId).on("click",()=>{this._switchTab(d.General)}),$(this._walkTabLabelId).on("click",()=>{this._switchTab(d.Walk)}),$(this._drawingTabLabelId).on("click",()=>{this._switchTab(d.Drawing)}),$(this._floorplanTabLabelId).on("click",()=>{this._switchTab(d.Floorplan)})}_switchTab(e){var t=$(this._generalTabLabelId),i=$(this._walkTabLabelId),s=$(this._drawingTabLabelId),r=$(this._floorplanTabLabelId),o=$(this._generalTabId),n=$(this._walkTabId),a=$(this._drawingTabId),l=$(this._floorplanTabId);switch(t.removeClass("selected"),o.removeClass("selected"),n.removeClass("selected"),i.removeClass("selected"),a.removeClass("selected"),s.removeClass("selected"),l.removeClass("selected"),r.removeClass("selected"),e){case d.General:t.addClass("selected"),o.addClass("selected");break;case d.Walk:n.addClass("selected"),i.addClass("selected");break;case d.Drawing:a.addClass("selected"),s.addClass("selected");break;case d.Floorplan:l.addClass("selected"),r.addClass("selected")}}_updateSettings(){var e=this._viewer.view,t=this._viewer.model,i=this._viewer.selectionManager,s=this._viewer.cuttingManager,r=this._viewer.measureManager,o=this._viewer.operatorManager,n=(this._versionInfo&&($("#settings-format-version").html(this._viewer.getFormatVersionString()),$("#settings-viewer-version").html(this._viewer.getViewerVersionString()),this._versionInfo=!1),e.getBackgroundColor());let a;a=null===n.top?E.colorFromRgbString("rgb(192,220,248)"):n.top;let l;l=null===n.bottom?E.colorFromRgbString("rgb(192,220,248)"):n.bottom;var n=i.getNodeSelectionColor(),d=i.getNodeElementSelectionColor(),r=r.getMeasurementColor(),h=e.getProjectionMode(),c=e.getBackfacesVisible(),_=e.getHiddenLineSettings().getObscuredLineOpacity(),u=s.getCappingGeometryVisibility(),i=i.getHighlightFaceElementSelection()&&i.getHighlightLineElementSelection(),p=s.getCappingFaceColor(),s=s.getCappingLineColor(),g=e.getAmbientOcclusionEnabled(),m=e.getAmbientOcclusionRadius(),v=e.getAntiAliasingMode()===N.AntiAliasingMode.SMAA,w=e.getBloomEnabled(),C=e.getBloomIntensityScale(),b=e.getBloomThreshold(),y=e.getSilhouetteEnabled(),f=e.getSimpleReflectionEnabled(),I=e.getSimpleShadowEnabled(),S=e.getSimpleShadowInteractiveUpdateEnabled(),M=e.getSimpleShadowBlurSamples(),T=t.getPmiColor(),t=t.getPmiColorOverride(),o=o.getOperator(N.OperatorId.Orbit).getOrbitFallbackMode()===N.OrbitFallbackMode.CameraTarget,k=this._axisTriad.getEnabled(),x=this._navCube.getEnabled(),P=[];return P.push(this._updateWalkSettings()),this._updateDrawingSettings(),this._updateFloorplanSettings(),$("#settings-selection-color-body").minicolors("value",E.rgbStringFromColor(n)),$("#settings-selection-color-face-line").minicolors("value",E.rgbStringFromColor(d)),$("#settings-background-top").minicolors("value",E.rgbStringFromColor(a)),$("#settings-background-bottom").minicolors("value",E.rgbStringFromColor(l)),$("#settings-measurement-color").minicolors("value",E.rgbStringFromColor(r)),$("#settings-capping-face-color").minicolors("value",E.rgbStringFromColor(p)),$("#settings-capping-line-color").minicolors("value",E.rgbStringFromColor(s)),$("#settings-projection-mode").val(""+h),$("#settings-show-backfaces").prop("checked",c),$("#settings-show-capping-geometry").prop("checked",u),$("#settings-enable-face-line-selection").prop("checked",i),$("#settings-orbit-mode").prop("checked",o),$("#settings-select-scene-invisible").prop("checked",this._honorSceneVisibility),$("#settings-ambient-occlusion").prop("checked",g),$("#settings-ambient-occlusion-radius").val(""+m),$("#settings-anti-aliasing").prop("checked",v),$("#settings-bloom-intensity").val(""+C),$("#settings-bloom-threshold").val(""+b),$("#settings-axis-triad").prop("checked",k),$("#settings-nav-cube").prop("checked",x),$("#settings-silhouette-enabled").prop("checked",y),$("#settings-reflection-enabled").prop("checked",f),$("#settings-shadow-interactive").prop("checked",S),$("#settings-shadow-blur-samples").val(M),$("#settings-pmi-color").minicolors("value",E.rgbStringFromColor(T)),t!==$("#settings-pmi-enabled").prop("checked")&&$("#settings-pmi-enabled").trigger("click"),P.push(this._viewer.getMinimumFramerate().then(e=>{$("#settings-framerate").val(""+e)})),void 0!==_?$("#settings-hidden-line-opacity").val(""+_):$("#settings-hidden-line-opacity").val(""),w!==$("#settings-bloom-enabled").prop("checked")&&$("#settings-bloom-enabled").trigger("click"),I!==$("#settings-shadow-enabled").prop("checked")&&$("#settings-shadow-enabled").trigger("click"),P.push(e.getPointSize().then(e=>{var t=e[0],e=e[1],t=(this._splatRenderingEnabled=1!==t||e!==N.PointSizeUnit.ScreenPixels,this._splatRenderingEnabled!==$("#settings-splat-rendering-enabled").prop("checked")&&$("#settings-splat-rendering-enabled").trigger("click"),this._splatRenderingEnabled&&(this._splatRenderingSize=t,this._splatRenderingPointSizeUnit=e),$("#settings-splat-rendering-size"));Number(t.prop("step"))>this._splatRenderingSize&&t.prop("step",""+this._splatRenderingSize/3),t.val(""+this._splatRenderingSize),$("#settings-splat-rendering-point-size-unit").val(""+this._splatRenderingPointSizeUnit)})),P.push(e.getEyeDomeLightingEnabled().then(e=>{$("#settings-eye-dome-lighting-enabled").prop("checked",e)})),N.Util.waitForAll(P)}_applySettings(){var e=[],t=this._viewer.view,i=this._viewer.model,s=this._viewer.cuttingManager,r=this._viewer.selectionManager,o=(e.push(this._applyWalkSettings()),E.colorFromRgbString(E.getValueAsString("#settings-background-top"))),n=E.colorFromRgbString(E.getValueAsString("#settings-background-bottom")),o=(this._viewer.view.setBackgroundColor(o,n),E.colorFromRgbString(E.getValueAsString("#settings-selection-color-body"))),n=(r.setNodeSelectionColor(o),r.setNodeSelectionOutlineColor(o),E.colorFromRgbString(E.getValueAsString("#settings-selection-color-face-line"))),o=(r.setNodeElementSelectionColor(n),r.setNodeElementSelectionOutlineColor(n),$("#settings-enable-face-line-selection").prop("checked")),n=(r.setHighlightFaceElementSelection(o),r.setHighlightLineElementSelection(o),this._viewer.measureManager.setMeasurementColor(E.colorFromRgbString(E.getValueAsString("#settings-measurement-color"))),E.colorFromRgbString(E.getValueAsString("#settings-pmi-color"))),r=$("#settings-pmi-enabled").prop("checked"),o=(n&&r?(i.setPmiColor(n),i.setPmiColorOverride(!0)):i.setPmiColorOverride(!1),e.push(s.setCappingFaceColor(E.colorFromRgbString(E.getValueAsString("#settings-capping-face-color")))),e.push(s.setCappingLineColor(E.colorFromRgbString(E.getValueAsString("#settings-capping-line-color")))),t.setProjectionMode(parseInt(E.getValueAsString("#settings-projection-mode"),10)),$("#settings-show-backfaces").prop("checked")),r=(t.setBackfacesVisible(o),$("#settings-show-capping-geometry").prop("checked")),n=(e.push(s.setCappingGeometryVisibility(r)),parseInt(E.getValueAsString("#settings-framerate"),10)),i=(n&&0<n&&this._viewer.setMinimumFramerate(n),parseFloat(E.getValueAsString("#settings-hidden-line-opacity"))),o=(t.getHiddenLineSettings().setObscuredLineOpacity(i),t.getDrawMode()===N.DrawMode.HiddenLine&&t.setDrawMode(N.DrawMode.HiddenLine),this._viewer.operatorManager.getOperator(N.OperatorId.Orbit)),s=$("#settings-orbit-mode").prop("checked"),r=(o.setOrbitFallbackMode(s?N.OrbitFallbackMode.CameraTarget:N.OrbitFallbackMode.ModelCenter),this._honorSceneVisibility=$("#settings-select-scene-invisible").prop("checked"),this._honorSceneVisibility?N.SelectionMask.None:N.SelectionMask.All),n=this._viewer.operatorManager.getOperator(N.OperatorId.Select),i=n.getPickConfig();return i.forceEffectiveSceneVisibilityMask=r,n.setPickConfig(i),this._viewer.operatorManager.getOperator(N.OperatorId.AreaSelect).setForceEffectiveSceneVisibilityMask(r),this._viewer.operatorManager.getOperator(N.OperatorId.RayDrillSelect).setForceEffectiveSceneVisibilityMask(r),t.setAmbientOcclusionEnabled($("#settings-ambient-occlusion").prop("checked")),t.setAmbientOcclusionRadius(parseFloat(E.getValueAsString("#settings-ambient-occlusion-radius"))),$("#settings-anti-aliasing").prop("checked")?t.setAntiAliasingMode(N.AntiAliasingMode.SMAA):t.setAntiAliasingMode(N.AntiAliasingMode.None),t.setBloomEnabled($("#settings-bloom-enabled").prop("checked")),t.setBloomIntensityScale(parseFloat(E.getValueAsString("#settings-bloom-intensity"))),t.setBloomThreshold(parseFloat(E.getValueAsString("#settings-bloom-threshold"))),t.setSilhouetteEnabled($("#settings-silhouette-enabled").prop("checked")),t.setSimpleReflectionEnabled($("#settings-reflection-enabled").prop("checked")),t.setSimpleShadowEnabled($("#settings-shadow-enabled").prop("checked")),t.setSimpleShadowInteractiveUpdateEnabled($("#settings-shadow-interactive").prop("checked")),t.setSimpleShadowBlurSamples(parseInt(E.getValueAsString("#settings-shadow-blur-samples"),10)),$("#settings-axis-triad").prop("checked")?this._axisTriad.enable():this._axisTriad.disable(),$("#settings-nav-cube").prop("checked")?this._navCube.enable():this._navCube.disable(),$("#settings-splat-rendering-enabled").prop("checked")?(this._splatRenderingEnabled=!0,this._splatRenderingSize=parseFloat(E.getValueAsString("#settings-splat-rendering-size")),this._splatRenderingPointSizeUnit=parseInt(E.getValueAsString("#settings-splat-rendering-point-size-unit"),10),t.setPointSize(this._splatRenderingSize,this._splatRenderingPointSizeUnit)):(this._splatRenderingEnabled=!1,t.setPointSize(1,N.PointSizeUnit.ScreenPixels)),t.setEyeDomeLightingEnabled($("#settings-eye-dome-lighting-enabled").prop("checked")),e.push(this._applyDrawingSettings()),e.push(this._applyFloorplanSettings()),N.Util.waitForAll(e)}_applyWalkKeyText(e,t){t<N.KeyCode.a||t>N.KeyCode.z||(e=this._walkKeyIdsMap.get(e),t=N.KeyCode[t].toUpperCase(),$("#"+e).html(t))}_applyWalkSettings(){return __awaiter(this,void 0,void 0,function*(){var e=this._viewer.operatorManager,t=e.getOperator(N.OperatorId.KeyboardWalk),e=e.getOperator(N.OperatorId.WalkMode),i=parseInt(E.getValueAsString("#settings-walk-mode"),10),s=(yield e.setWalkMode(i),parseInt(E.getValueAsString("#settings-walk-rotation"),10)),r=parseFloat(E.getValueAsString("#settings-walk-speed"))*this._walkSpeedUnits,o=parseFloat(E.getValueAsString("#settings-walk-elevation"))*this._walkSpeedUnits,n=parseInt(E.getValueAsString("#settings-walk-view-angle"),10),a=$("#settings-mouse-look-enabled").prop("checked"),l=parseInt(E.getValueAsString("#settings-mouse-look-speed"),10),d=$("#settings-bim-mode-enabled").prop("checked");$("#walk-navigation-keys .walk-key").html(""),t.getKeyMapping().forEach((e,t)=>{this._applyWalkKeyText(e,t)}),0==r?(yield e.resetDefaultWalkSpeeds(),this._updateWalkSettingsHelper()):(e.setRotationSpeed(s),e.setWalkSpeed(r),e.setElevationSpeed(o),e.setViewAngle(n),i===N.WalkMode.Keyboard&&(t.setMouseLookEnabled(a),t.setMouseLookSpeed(l))),d?(yield this._viewer.model.registerIfcNodes(this._viewer.model.getAbsoluteRootNode()),yield e.setBimModeEnabled(!0)):yield e.setBimModeEnabled(!1)})}_updateKeyboardWalkModeStyle(e){this._updateEnabledStyle(null,["walk-mouse-look-text","settings-mouse-look-style","walk-navigation-keys"],["settings-mouse-look-enabled","settings-mouse-look-speed"],e===N.WalkMode.Keyboard)}_updateWalkSpeedUnits(e){e=Math.log(e)/Math.LN10;this._walkSpeedUnits=Math.pow(10,Math.floor(e));let t="m";this._walkSpeedUnits<=.001?t="&micro;m":this._walkSpeedUnits<=1?t="mm":this._walkSpeedUnits<=10?t="cm":this._walkSpeedUnits=1e3,$("#walk-speed-units").html(t),$("#elevation-speed-units").html(t)}_updateWalkSettingsHelper(){var e=this._viewer.operatorManager,t=e.getOperator(N.OperatorId.KeyboardWalk),e=e.getOperator(N.OperatorId.WalkMode),i=t.getRotationSpeed(),s=t.getWalkSpeed(),r=t.getElevationSpeed(),o=t.getViewAngle(),n=t.getMouseLookEnabled(),a=t.getMouseLookSpeed(),t=t.isBimModeEnabled(),e=e.getWalkMode();this._updateWalkSpeedUnits(s),$("#settings-walk-mode").val(""+e),$("#settings-walk-rotation").val(""+i),$("#settings-walk-speed").val((s/this._walkSpeedUnits).toFixed(1)),$("#settings-walk-elevation").val((r/this._walkSpeedUnits).toFixed(1)),$("#settings-walk-view-angle").val(""+o),$("#settings-mouse-look-speed").val(""+a),this._updateEnabledStyle("settings-mouse-look-enabled",["settings-mouse-look-style"],["settings-mouse-look-speed"],n),this._updateEnabledStyle("settings-bim-mode-enabled",[],[],t),this._updateKeyboardWalkModeStyle(e)}_updateWalkSettings(){return __awaiter(this,void 0,void 0,function*(){var e=this._viewer.operatorManager.getOperator(N.OperatorId.KeyboardWalk);0===e.getWalkSpeed()&&(yield e.resetDefaultWalkSpeeds()),this._updateWalkSettingsHelper()})}_updateDrawingSettings(){var e=this._viewer.sheetManager.getSheetBackgroundColor(),t=this._viewer.sheetManager.getSheetColor(),i=this._viewer.sheetManager.getSheetShadowColor(),s=this._viewer.sheetManager.getBackgroundSheetEnabled();$("#settings-drawing-background").minicolors("value",E.rgbStringFromColor(e)),$("#settings-drawing-sheet").minicolors("value",E.rgbStringFromColor(t)),$("#settings-drawing-sheet-shadow").minicolors("value",E.rgbStringFromColor(i)),$("#settings-drawing-background-enabled").prop("checked",s)}_applyDrawingSettings(){return __awaiter(this,void 0,void 0,function*(){var e=E.colorFromRgbString(E.getValueAsString("#settings-drawing-background")),t=E.colorFromRgbString(E.getValueAsString("#settings-drawing-sheet")),i=E.colorFromRgbString(E.getValueAsString("#settings-drawing-sheet-shadow")),s=$("#settings-drawing-background-enabled").prop("checked");yield this._viewer.sheetManager.setBackgroundSheetEnabled(s),yield this._viewer.sheetManager.setSheetColors(e,t,i)})}_updateFloorplanSettings(){var e=this._viewer.floorplanManager,t=e.getConfiguration(),e=e.isActive();switch(this._floorplanActive=e,$("#settings-floorplan-active").prop("checked",e),$("#settings-floorplan-track-camera").prop("checked",t.trackCameraEnabled),t.floorplanOrientation){case N.FloorplanOrientation.NorthUp:$("#settings-floorplan-orientation").val("0");break;case N.FloorplanOrientation.AvatarUp:$("#settings-floorplan-orientation").val("1")}switch(t.autoActivate){case N.FloorplanAutoActivation.Bim:$("#settings-floorplan-auto-activate").val("0");break;case N.FloorplanAutoActivation.BimWalk:$("#settings-floorplan-auto-activate").val("1");break;case N.FloorplanAutoActivation.Never:$("#settings-floorplan-auto-activate").val("2")}$("#settings-floorplan-feet-per-pixel").val(""+t.overlayFeetPerPixel),$("#settings-floorplan-zoom").val(""+t.zoomLevel),$("#settings-floorplan-background-opacity").val(""+t.backgroundOpacity),$("#settings-floorplan-border-opacity").val(""+t.borderOpacity),$("#settings-floorplan-avatar-opacity").val(""+t.avatarOpacity),$("#settings-floorplan-background-color").minicolors("value",E.rgbStringFromColor(t.backgroundColor)),$("#settings-floorplan-border-color").minicolors("value",E.rgbStringFromColor(t.borderColor)),$("#settings-floorplan-avatar-color").minicolors("value",E.rgbStringFromColor(t.avatarColor)),$("#settings-floorplan-avatar-outline-color").minicolors("value",E.rgbStringFromColor(t.avatarOutlineColor)),this._updateEnabledStyle(null,["settings-floorplan-zoom-style"],["settings-floorplan-zoom"],t.trackCameraEnabled),this._updateEnabledStyle(null,["settings-floorplan-feet-per-pixel-style"],["settings-floorplan-feet-per-pixel"],t.trackCameraEnabled)}_applyFloorplanSettings(){return __awaiter(this,void 0,void 0,function*(){var e=$("#settings-floorplan-active").prop("checked"),t=$("#settings-floorplan-track-camera").prop("checked");let i;switch($("#settings-floorplan-orientation").val()){case"0":i=N.FloorplanOrientation.NorthUp;break;case"1":i=N.FloorplanOrientation.AvatarUp;break;default:i=N.FloorplanOrientation.NorthUp}let s;switch($("#settings-floorplan-auto-activate").val()){case"0":s=N.FloorplanAutoActivation.Bim;break;case"1":s=N.FloorplanAutoActivation.BimWalk;break;case"2":s=N.FloorplanAutoActivation.Never;break;default:s=N.FloorplanAutoActivation.BimWalk}var r=parseFloat(E.getValueAsString("#settings-floorplan-feet-per-pixel")),o=parseFloat(E.getValueAsString("#settings-floorplan-zoom")),n=parseFloat(E.getValueAsString("#settings-floorplan-background-opacity")),a=parseFloat(E.getValueAsString("#settings-floorplan-border-opacity")),l=parseFloat(E.getValueAsString("#settings-floorplan-avatar-opacity")),d=E.colorFromRgbString(E.getValueAsString("#settings-floorplan-background-color")),h=E.colorFromRgbString(E.getValueAsString("#settings-floorplan-border-color")),c=E.colorFromRgbString(E.getValueAsString("#settings-floorplan-avatar-color")),_=E.colorFromRgbString(E.getValueAsString("#settings-floorplan-avatar-outline-color")),u=this._viewer.floorplanManager.getConfiguration(),r=(u.trackCameraEnabled=t,u.floorplanOrientation=i,u.autoActivate=s,u.overlayFeetPerPixel=r,u.zoomLevel=o,u.backgroundOpacity=n,u.borderOpacity=a,u.avatarOpacity=l,u.backgroundColor=d,u.borderColor=h,u.avatarColor=c,u.avatarOutlineColor=_,this._updateEnabledStyle(null,["settings-floorplan-zoom-style"],["settings-floorplan-zoom"],t),this._updateEnabledStyle(null,["settings-floorplan-feet-per-pixel-style"],["settings-floorplan-feet-per-pixel"],t),yield this._viewer.floorplanManager.setConfiguration(u),e&&!this._floorplanActive?(this._floorplanActive=!0,yield this._viewer.floorplanManager.activate()):!e&&this._floorplanActive&&(this._floorplanActive=!1,yield this._viewer.floorplanManager.deactivate()),this._viewer.floorplanManager.isActive());$("#settings-floorplan-active").prop("checked",r)})}_updateEnabledStyle(e,t,i,s){if(null!==e&&$("#"+e).prop("checked",s),s)for(const r of t)$("#"+r).removeClass("grayed-out");else for(const o of t)$("#"+o).addClass("grayed-out");for(const n of i)$("#"+n).prop("disabled",!s)}}}}(Communicator=Communicator||{}),function(e){{var s=e.Ui||(e.Ui={});class r{constructor(e,t,i){this._maxNodeChildrenSize=300,this._tree=new s.Control.TreeControl(t,e,r.separator,i),this._internalId=t+"Id",this._viewer=e}getElementId(){return this._tree.getElementId()}registerCallback(e,t){this._tree.registerCallback(e,t)}_splitHtmlId(e){return this._splitHtmlIdParts(e,r.separator)}_splitHtmlIdParts(e,t){var i=e.lastIndexOf(t);return-1===i?["",e]:[e.substring(0,i),e.substring(i+t.length)]}hideTab(){$(`#${this.getElementId()}Tab`).hide()}showTab(){$(`#${this.getElementId()}Tab`).show()}_getTreeControl(){return this._tree}}r.separator="_",r.visibilityPrefix="visibility",s.ViewTree=r}}(Communicator=Communicator||{}),function(l){(l.Ui||(l.Ui={})).BCFTree=class{constructor(e,t,i){this._idCount=0,this._viewpointIdMap=new Map,this._bcfIdMap=new Map,this._topicGuidMap=new Map,this._topicTitleGuidMap=new Map,this._topicCommentsGuidMap=new Map,this._commentGuidMap=new Map,this._viewer=e,this._elementId=t,this._scroll=i,this._listRoot=document.createElement("ul"),this._bcfDataList=document.createElement("select"),this._initEvents()}hideTab(){$(`#${this._elementId}Tab`).hide()}showTab(){$(`#${this._elementId}Tab`).show()}getElementId(){return this._elementId}_refreshScroll(){this._scroll&&this._scroll.refresh()}_showBCFData(i){jQuery("#"+i).show(),this._bcfIdMap.forEach((e,t)=>{t!==i&&jQuery("#"+t).hide()}),this._refreshScroll()}_events(e){$(e).on("click",".ui-bcf-topic",t=>__awaiter(this,void 0,void 0,function*(){var e=jQuery(t.target).closest(".viewpoint, .comment").get(0);void 0!==e&&(yield this._onTreeSelectItem(e.id))})),$(e).on("change","select",e=>{e=jQuery(e.target).closest("select").get(0);e&&this._showBCFData(e.value)})}_addBCFComment(o,n,a){return __awaiter(this,void 0,void 0,function*(){var e=o.getMarkup(),t=new Date,i=l.UUID.create(),s=i+".bcfv",r=yield l.BCFViewpoint.createViewpoint(this._viewer,s,a),r=(o.setViewpoint(s,r),i+".png");return yield this._addSnapshot(o,r),e.addViewpoint(i,s,r),e.addComment(t,"",n,i)})}_addSnapshot(t,i){return __awaiter(this,void 0,void 0,function*(){var e=yield this._viewer.takeSnapshot();t.addSnapshot(i,l.BCFSnapshot.snapshotDataFromImage(e))})}_removeBcf(e){this._viewer.BCFManager.removeBCFData(e)}_buildRemoveBCF(e){var t=document.createElement("div"),i=(t.classList.add("ui-bcf-input"),document.createElement("button"));return i.textContent="Remove BCF",t.appendChild(i),i.onclick=()=>__awaiter(this,void 0,void 0,function*(){this._removeBcf(e)}),t}_addBcf(t){return __awaiter(this,void 0,void 0,function*(){var e=this._viewer.BCFManager.createBCFData(t);return yield this._addTopic(e,t),e})}_buildAddBCF(){var e=document.createElement("div"),t=(e.classList.add("ui-bcf-input"),document.createElement("label"));t.textContent="BCF Name: ",t.htmlFor="bcf_name";const i=document.createElement("input");i.id="bcf_name",i.placeholder="BCF Name...";var s=document.createElement("button");return s.textContent="Add BCF",e.appendChild(t),e.appendChild(i),e.appendChild(s),s.onclick=()=>__awaiter(this,void 0,void 0,function*(){var e=i.value;0<e.length&&(i.value="",yield this._addBcf(e))}),e}_buildOpenBCF(){var e=document.createElement("div");e.classList.add("ui-bcf-input");const r=document.createElement("input");return r.type="file",r.accept=".bcf,.bcfzip",r.multiple=!0,e.appendChild(r),r.onchange=()=>__awaiter(this,void 0,void 0,function*(){var t=r.files;if(null!==t)for(let e=0;e<t.length;++e){const i=t[e],s=new FileReader;s.onload=()=>__awaiter(this,void 0,void 0,function*(){var e=s.result;null!==e&&"object"==typeof e&&(yield this._viewer.BCFManager.addBCFFromBuffer(e,i.name.split(".")[0]))}),s.readAsArrayBuffer(i)}r.value=""}),e}_addTopic(s,r){return __awaiter(this,void 0,void 0,function*(){var e=this._viewer.markupManager.getActiveMarkupView(),e=yield l.BCFTopic.createTopic(this._viewer,s.getId(),s.getFilename(),r,e),t=(s.addTopic(e.getTopicId(),e),this._buildTopic(s,e)),i=this._getBcfHtmlId(s.getId());return null!==i&&null!==(i=document.getElementById(i))&&i.appendChild(t),e})}_buildAddTopic(t){var e=document.createElement("div"),i=(e.classList.add("ui-bcf-input"),document.createElement("label"));i.textContent="Topic Title: ",i.htmlFor="topic_title";const s=document.createElement("input");s.id="topic_title",s.placeholder="Topic Title...";var r=document.createElement("button");return r.textContent="Add Topic",e.appendChild(i),e.appendChild(s),e.appendChild(r),r.onclick=()=>__awaiter(this,void 0,void 0,function*(){var e=s.value;0<e.length&&(s.value="",yield this._addTopic(t,e))}),e}_initEvents(){var e=document.getElementById(this._elementId);if(null===e)throw new l.CommunicatorError("container is null");this._events(e),e.appendChild(this._buildAddBCF()),e.appendChild(this._buildOpenBCF()),this._listRoot.classList.add("ui-modeltree"),this._listRoot.classList.add("ui-modeltree-item"),e.appendChild(this._bcfDataList),e.appendChild(this._listRoot),this._viewer.setCallbacks({firstModelLoaded:e=>{const t=this._viewer.model;e.forEach(e=>{t.getModelFileTypeFromNode(e)===l.FileType.Ifc&&this.showTab()})},bcfLoaded:(e,t)=>{this.showTab(),this._appendBCF(e,t)},bcfRemoved:e=>{this._removeBCF(e)}})}_buildBCFNode(e){var t=document.createElement("li");return t.classList.add("ui-modeltree-item"),t.id=e,t}_buildDiv(e,t,i){var s=document.createElement("div");return void 0!==i&&s.classList.add(i),s.id=e,s.innerHTML=t,s}_buildEditDiv(e,t,i,s,r){const o=document.createElement("input");return o.classList.add("ui-bcf-edit"),void 0!==r&&o.classList.add(r),o.id=e,o.value=t,o.placeholder=i,o.onblur=()=>{void 0!==s&&null!==o.textContent&&s(o.textContent)},o}_buildImage(e){var t=document.createElement("img");return t.id=this._getId(),t.src=e,t}_buildDeleteComment(e,t,i){var s=document.createElement("button");return s.classList.add("ui-bcf-comment-delete"),s.textContent="Delete",s.onclick=()=>{this._deleteComment(e,t,i)},s}_buildEditComment(t,i){const s=document.createElement("button");return s.textContent="Edit",s.onclick=()=>{var e;"true"===t.contentEditable?(t.contentEditable="false",s.textContent="Edit",null!==(e=t.textContent)&&this._setCommentText(i,e)):(t.contentEditable="true",s.textContent="Save")},s}_buildComment(e,t){var i=this._getId(),s=this._getViewpointFromComment(e,t),s=(null!==s&&this._viewpointIdMap.set(i,s),this._buildDiv(i,"","comment")),r="Created by "+t.getAuthor(),o=this._formatDate(t.getDate()),n=t.getText(),r=(s.appendChild(this._buildDiv(this._getId(),r)),s.appendChild(this._buildDiv(this._getId(),o)),t.getViewpointGuid()),r=(null!==r&&void 0!==(o=e.getMarkup().getViewpoints().get(r))&&null!==(r=o.getSnapshotFilename())&&null!==(o=e.getSnapshot(r))&&s.appendChild(this._buildImage(o.getUrl())),this._getId()),o=(this._commentGuidMap.set(t.getId(),r),this._buildDiv(r,n));return s.appendChild(o),s.appendChild(this._buildEditComment(o,t)),s.appendChild(this._buildDeleteComment(e,t,i)),s}_addComment(s,r){return __awaiter(this,void 0,void 0,function*(){var e=this._viewer.markupManager.getActiveMarkupView(),e=yield this._addBCFComment(s,r,e),t=this._buildComment(s,e),i=this._topicCommentsGuidMap.get(s.getTopicId());return void 0!==i&&null!==(i=document.getElementById(i))&&i.appendChild(t),e})}_deleteComment(e,t,i){i=document.getElementById(i);null!==i&&null!==i.parentElement&&(i.parentElement.removeChild(i),e.getMarkup().deleteComment(t.getId()),this._refreshScroll())}_setCommentText(e,t){var i=this._commentGuidMap.get(e.getId());void 0!==i&&null!==(i=document.getElementById(i))&&(e.setText(t),i.textContent=t,this._refreshScroll())}_buildAddComment(t){var e=this._buildDiv(this._getId(),"");const i=document.createElement("textarea");i.style.width="100%",e.appendChild(i);var s=document.createElement("button");return s.textContent="Add Comment",e.appendChild(s),s.onclick=()=>__awaiter(this,void 0,void 0,function*(){var e=i.value;i.value="",0<e.length&&(yield this._addComment(t,e))}),e}_buildTopicData(e,t){var i=document.createElement("div");return i.classList.add("topic-data"),i.innerHTML=null!=t?`<b>${e}</b>: `+t:`<b>${e}</b>: -`,i}_formatDate(e){return void 0===e?"-":e.toDateString()}_deleteTopic(e,t){var i=this._topicGuidMap.get(t.getTopicId());return void 0!==i&&null!==(i=document.getElementById(i))&&null!==i.parentElement&&i.parentElement.removeChild(i),e.getTopics().delete(t.getTopicId())}_buildDeleteTopic(e,t){var i=document.createElement("button");return i.textContent="Delete Topic",i.classList.add("ui-bcf-delete"),i.onclick=()=>__awaiter(this,void 0,void 0,function*(){this._deleteTopic(e,t)}),i}_setTopicTitle(e,t){var i=this._topicTitleGuidMap.get(e.getTopicId());void 0!==i&&null!==(i=document.getElementById(i))&&(i.textContent=t),e.getMarkup().setTopicTitle(t)}_buildTopic(e,t){var i=this._getId(),s=t.getTopicId(),i=(this._topicGuidMap.set(s,i),this._buildDiv(i,"","ui-bcf-topic")),r=t.getMarkup(),o=r.getTopicTitle(),n=i.appendChild(this._buildDiv(this._getId(),"","index-and-title")),a=r.getTopicIndex(),a=(null!==a&&(a="<b>Index</b>: "+a,n.appendChild(this._buildDiv(this._getId(),a,"index"))),this._getId()),n=(this._topicTitleGuidMap.set(s,a),n.appendChild(this._buildEditDiv(a,o,"Topic Title",e=>{this._setTopicTitle(t,e)},"title")),t.getViewpoint("viewpoint.bcfv")),n=(null!==n&&(a=this._getId(),this._viewpointIdMap.set(a,n),o=this._buildDiv(a,"","viewpoint"),null!==(a=t.getSnapshot(n.getFilename()))&&o.appendChild(this._buildImage(a.getUrl())),i.appendChild(o)),this._buildDiv(this._getId(),"")),a=(n.appendChild(this._buildTopicData("Author",r.getTopicCreationAuthor())),n.appendChild(this._buildTopicData("Description",r.getTopicDescription())),n.appendChild(this._buildTopicData("Created",this._formatDate(r.getTopicCreationDate()))),n.appendChild(this._buildTopicData("Type",r.getTopicType())),n.appendChild(this._buildTopicData("Priority",r.getTopicPriority())),n.appendChild(this._buildTopicData("Stage",r.getTopicStage())),n.appendChild(this._buildTopicData("TopicId",t.getTopicId())),i.appendChild(n),this._getId());const l=this._buildDiv(a,"");this._topicCommentsGuidMap.set(s,a),t.getMarkup().getComments().forEach(e=>{l.appendChild(this._buildComment(t,e))}),i.appendChild(l);o=this._buildAddComment(t);return o.appendChild(this._buildDeleteTopic(e,t)),i.appendChild(o),i}_buildSelectOption(e,t){var i=document.createElement("option");return i.id=this._getSelectId(t),i.value=t,i.textContent=e,i}_appendBCF(e,t){const i=this._viewer.BCFManager.getBCFData(e);if(null!==i){var s=this._getId();this._showBCFData(s),this._bcfIdMap.set(s,e),this._bcfDataList.appendChild(this._buildSelectOption(e+". "+t,s)),this._bcfDataList.value=s;const r=this._buildBCFNode(s);this._listRoot.appendChild(r),r.appendChild(this._buildRemoveBCF(i.getId())),r.appendChild(this._buildAddTopic(i)),i.getTopics().forEach(e=>{e=this._buildTopic(i,e);r.appendChild(e)}),this._refreshScroll()}}_getBcfHtmlId(i){let s=null;return this._bcfIdMap.forEach((e,t)=>{i===e&&(s=t)}),s}_removeBCF(e){var e=this._getBcfHtmlId(e);null!==e&&(this._bcfIdMap.delete(e),$("#"+e).remove(),$("#"+this._getSelectId(e)).remove(),0<(e=this._bcfDataList.value).length)&&this._showBCFData(e)}_getViewpointFromComment(e,t){t=t.getViewpointGuid();if(null!==t){t=e.getMarkup().getViewpoints().get(t);if(void 0!==t){t=t.getViewpointFilename();if(null!==t)return e.getViewpoint(t)}}return null}_getId(){return"bcf_"+ ++this._idCount}_getSelectId(e){return"select_"+e}_onTreeSelectItem(t){return __awaiter(this,void 0,void 0,function*(){var e=this._getViewpoint(t);null!==e&&(yield e.activate())})}_getViewpoint(e){return this._viewpointIdMap.get(e)||null}}}(Communicator=Communicator||{}),function(i){{var r=i.Ui||(i.Ui={});class e extends r.ViewTree{constructor(e,t,i){super(e,t,i),this._annotationViewsString="annotationViews",this._annotationViewsLabel="Annotation Views",this._viewFolderCreated=!1,this._lastSelectedhtmlId=null,this._cadViewIds=new Set,this._tree.setCreateVisibilityItems(!1),this._initEvents()}_initEvents(){this._viewer.setCallbacks({firstModelLoaded:(e,t)=>__awaiter(this,void 0,void 0,function*(){t||this._updateCadViews()}),subtreeLoaded:()=>{this._updateCadViews()},configurationActivated:()=>{this._tree.clear(),this._cadViewIds.clear(),this._viewFolderCreated=!1,this._updateCadViews()},modelSwitched:()=>{this._modelSwitched()},sheetActivated:()=>{var e;this._viewer.model.isDrawing()&&(null!=this._lastSelectedhtmlId&&null!==(e=document.getElementById(this._lastSelectedhtmlId))&&e.classList.remove("selected"),this.hideTab())},sheetDeactivated:()=>{this._viewer.model.isDrawing()&&this.showTab()},cadViewCreated:(e,t)=>{var i=new Map;i.set(e,t),this._addCadViews(i)}}),this._tree.registerCallback("selectItem",e=>__awaiter(this,void 0,void 0,function*(){yield this._onTreeSelectItem(e)}))}_modelSwitched(){this._tree.clear(),this._cadViewIds.clear(),this._viewFolderCreated=!1,this._updateCadViews()}_updateCadViews(){var e=this._viewer.model.getCadViewMap();this._addCadViews(e)}_addCadViews(e){this._createCadViewNodes(e),e.size<=0?this.hideTab():this.showTab(),this._tree.expandInitialNodes(this._internalId),this._tree.expandInitialNodes(this._internalId+this._annotationViewsString)}_allowView(e){var t=this._viewer.model.getActiveCadConfiguration(),e=this._viewer.model.getCadViewConfiguration(e);return null===t||null===e||e===t}_createCadViewNodes(e){if(0!==e.size){this._viewFolderCreated||(this._tree.appendTopLevelElement("Views",this._internalId,"viewfolder",!0),this._viewFolderCreated=!0);const i=this._viewer.model,t=!0===this._viewer.getCreationParameters().enableShatteredModelUiViews,s=e=>this._allowView(e)&&(t||!i.isWithinExternalModel(e));e.forEach((e,t)=>{this._cadViewIds.has(t)||!s(t)||i.isAnnotationView(t)||(this._cadViewIds.add(t),this._tree.addChild(e,this._cadViewId(t),this._internalId,"view",!1,r.Desktop.Tree.CadView))}),e.forEach((e,t)=>{!this._cadViewIds.has(t)&&s(t)&&i.isAnnotationView(t)&&null===document.getElementById(this._internalId+this._annotationViewsString)&&this._tree.addChild(this._annotationViewsLabel,this._internalId+this._annotationViewsString,this._internalId,"viewfolder",!0,r.Desktop.Tree.CadView)}),e.forEach((e,t)=>{!this._cadViewIds.has(t)&&s(t)&&i.isAnnotationView(t)&&(this._cadViewIds.add(t),e=e.split("# Annotation View")[0],this._tree.addChild(e,this._cadViewId(t),this._internalId+this._annotationViewsString,"view",!1,r.Desktop.Tree.CadView))})}}_onTreeSelectItem(t){return __awaiter(this,void 0,void 0,function*(){var e=this._splitHtmlId(t),e=(e[0]===this._internalId&&(yield this._viewer.operatorManager.getOperator(i.OperatorId.Handle).removeHandles(),yield this._viewer.model.activateCadView(parseInt(e[1],10))),document.getElementById(t));null!==e&&("LI"===e.tagName&&t!==this._internalId&&t!==this._internalId+this._annotationViewsString?(e.classList.add("selected"),this._lastSelectedhtmlId=t):e.classList.remove("selected"))})}_cadViewId(e){return this._internalId+r.ViewTree.separator+e}}r.CadViewTree=e,r.CADViewTree=e}}(Communicator=Communicator||{}),function(i){{var r=i.Ui||(i.Ui={});class e extends r.ViewTree{constructor(e,t,i){super(e,t,i),this._tree.setCreateVisibilityItems(!1),this._initEvents()}_initEvents(){this._viewer.setCallbacks({firstModelLoaded:()=>__awaiter(this,void 0,void 0,function*(){yield this._onNewModel()}),modelSwitched:()=>__awaiter(this,void 0,void 0,function*(){yield this._modelSwitched()}),configurationActivated:e=>{this._tree.selectItem(this._configurationsId(e),!1)}}),this._tree.registerCallback("selectItem",e=>__awaiter(this,void 0,void 0,function*(){yield this._onTreeSelectItem(e)}))}_modelSwitched(){return this._onNewModel()}_onNewModel(){return __awaiter(this,void 0,void 0,function*(){var e=this._viewer.model;(yield e.cadConfigurationsEnabled())&&(this._createConfigurationNodes()?(this.showTab(),yield e.activateDefaultCadConfiguration()):this.hideTab()),null!==e.getDefaultCadView()&&(yield e.activateDefaultCadView())})}_createConfigurationNodes(){var e=this._viewer.model.getCadConfigurations(),t=Object.keys(e);if(0<t.length){this._tree.appendTopLevelElement("Configurations",this._internalId,"configurations",!0);for(const s of t){var i=parseInt(s,10);this._tree.addChild(e[i],this._configurationsId(i),this._internalId,"view",!1,r.Desktop.Tree.Configurations)}return this._tree.expandInitialNodes(this._internalId),!0}return!1}_onTreeSelectItem(t){return __awaiter(this,void 0,void 0,function*(){var e=this._splitHtmlId(t);this._internalId===e[0]&&(yield this._viewer.operatorManager.getOperator(i.OperatorId.Handle).removeHandles(),yield this._viewer.model.activateCadConfiguration(parseInt(e[1],10)))})}_configurationsId(e){return this._internalId+r.ViewTree.separator+e}}r.ConfigurationsTree=e}}(Communicator=Communicator||{}),function(e){{var t=e.Ui||(e.Ui={});class i extends t.ViewTree{constructor(e,t,i){super(e,t,i),this._tree.setCreateVisibilityItems(!1),this._initEvents()}_initEvents(){var e=()=>{this._onNewModel()};this._viewer.setCallbacks({assemblyTreeReady:e,firstModelLoaded:e,modelSwitched:e,subtreeLoaded:e}),this._tree.registerCallback("selectItem",e=>__awaiter(this,void 0,void 0,function*(){yield this._onTreeSelectItem(e)}))}_onTreeSelectItem(t){return __awaiter(this,void 0,void 0,function*(){var e;null!==document.getElementById(t)&&(e=this._splitHtmlId(t))[0]===this._internalId&&(yield this._setFilter(parseInt(e[1],10)))})}_setFilter(s){return __awaiter(this,void 0,void 0,function*(){var e=yield this._viewer.model,t=e.getNodesFromFiltersId([s]);if(null!==t){const i=[];t.nodeIds.forEach(e=>{i.push(e)}),yield this._viewer.pauseRendering(),yield e.reset(),t.isInclusive?(yield e.setNodesVisibility([e.getAbsoluteRootNode()],!1),yield e.setNodesVisibility(i,!0)):yield e.setNodesVisibility(i,!1),yield this._viewer.resumeRendering()}})}_onNewModel(){this._tree.clear();var e=this._viewer.model.getFilters();e.forEach((e,t)=>{this._tree.appendTopLevelElement(e,this.getFilterId(t),"assembly",!1)}),0<e.size?this.showTab():this.hideTab()}getFilterId(e){return this._internalId+t.ViewTree.separator+e}}t.FiltersTree=i}}(Communicator=Communicator||{}),function(n){{var d=n.Ui||(n.Ui={});class h extends d.ViewTree{constructor(e,t,i){super(e,t,i),this._layerNames=[],this._layerParts=new Set,this._initEvents()}_initEvents(){var e=()=>{this._onNewModel()};this._viewer.setCallbacks({firstModelLoaded:e,modelSwitched:e,subtreeLoaded:e,selectionArray:e=>{this._tree.updateSelection(e);for(const i of e){var t=i.getSelection().getNodeId();if(null!==t){for(const s of this._viewer.model.getNodeChildren(t))this._expandPart(s);this._expandPart(t)}}},visibilityChanged:()=>{this._tree.updateLayersVisibilityIcons()}}),this._tree.registerCallback("selectItem",(e,t)=>{this._onTreeSelectItem(e,t)}),this._tree.registerCallback("loadChildren",e=>{this._loadNodeChildren(e)})}_onTreeSelectItem(e,t=n.SelectionMode.Set){var i=document.getElementById(e);if(null!==i)switch(this._splitHtmlId(e)[0]){case"layerpart":this._selectLayerPart(e,t);break;case"layer":this._selectLayer(e,t)}}_selectLayerPart(e,t){e=h.getPartId(e);null!==e&&this._viewer.selectPart(e,t)}_selectLayer(e,t){e=h.getLayerName(e);null!==e&&this._viewer.selectionManager.selectLayer(e,t)}_onNewModel(){const s=this._viewer.model;this._tree.clear(),this._layerParts.clear(),this._layerNames=s.getUniqueLayerNames().sort(),this._layerNames.filter(e=>{var t=h._createLayerId(),i=(h._layerIdMap.set(t,e),h._idLayerMap.set(e,t),s.getLayerIdsFromName(e));return null!==i&&0<i.length&&(this._tree.appendTopLevelElement(e,t,"assembly",!0,!1),!0)}),0<this._layerNames.length?this.showTab():this.hideTab()}_loadNodeChildren(e){var t,i,e=h.getLayerName(e);null!==e&&null!==(t=h.getLayerId(e))&&null!==(i=this._viewer.model.getNodesFromLayerName(e,!0))&&(i.length<this._maxNodeChildrenSize?this._addLayerParts(t,i):this._addLayerPartContainers(t,i))}_addLayerParts(s,e){const r=this._viewer.model,o=r.isDrawing();e.forEach(e=>{var t=r.getNodeType(e),i=r.getModelFileTypeFromNode(e),t=(o||i===n.FileType.Dwg||t!==n.NodeType.BodyInstance||null!==(i=r.getNodeParent(e))&&(e=i),r.getNodeName(e)),i=h._createPartId(e);h._layerPartIdMap.set(i,e),h._idLayerPartMap.set(e,i),this._layerParts.has(e)||(this._layerParts.add(e),this._tree.addChild(t,i,s,"assembly",!1,d.Desktop.Tree.Layers))})}_addLayerPartContainers(t,i){var s=Math.ceil(i.length/this._maxNodeChildrenSize),r=[];for(let e=0;e<s;++e){var o=e*this._maxNodeChildrenSize,n=Math.min(o+this._maxNodeChildrenSize,i.length),a=`Child Nodes ${o} - `+n,l=h._createContainerId();r.push(l),this._tree.addChild(a,l,t,"container",!0,d.Desktop.Tree.Layers),this._addLayerParts(l,i.slice(o,n))}h._layerContainersMap.set(t,r)}_expandPart(t){if(this._viewer.model.isNodeLoaded(t)){var i=this._viewer.model.getNodeLayerId(t);if(null!==i){i=this._viewer.model.getLayerName(i);if(null!==i){var s=h.getLayerId(i);if(null!==s){var i=this._viewer.model.getNodesFromLayerName(i,!0);if(null!==i){let e=null;i.length>=this._maxNodeChildrenSize&&(i=i.indexOf(t),t=Math.floor(i/this._maxNodeChildrenSize),void 0!==(i=h._layerContainersMap.get(s)))&&t<i.length&&(e=i[t]),this._tree.expandChildren(s),null!==e&&this._tree.expandChildren(e)}}}}}}static _createLayerId(){return""+h.layerPrefix+h.separator+ ++this._idCount}static _createContainerId(){return""+h.layerPartContainerPrefix+h.separator+ ++this._idCount}static _createPartId(e){return""+h.layerPartPrefix+h.separator+e}static getLayerName(e){return this._layerIdMap.get(e)||null}static getLayerId(e){return this._idLayerMap.get(e)||null}static getPartId(e){return this._layerPartIdMap.get(e)||null}static getLayerPartId(e){return this._idLayerPartMap.get(e)||null}}h.layerPrefix="layer",h.layerPartPrefix="layerpart",h.layerPartContainerPrefix="layerpartcontainer",h._idCount=0,h._layerIdMap=new Map,h._idLayerMap=new Map,h._layerPartIdMap=new Map,h._idLayerPartMap=new Map,h._layerContainersMap=new Map,d.LayersTree=h}}(Communicator=Communicator||{}),function(d){{var h=d.Ui||(d.Ui={});class i extends h.ViewTree{constructor(e,t,i){super(e,t,i),this._lastModelRoot=null,this._startedWithoutModelStructure=!1,this._partSelectionEnabled=!0,this._currentSheetId=null,this._measurementFolderId="measurementitems",this._updateVisibilityStateTimer=new d.Util.Timer,this._updateSelectionTimer=new d.Util.Timer,this._initEvents()}freezeExpansion(e){this._tree.freezeExpansion(e)}modelStructurePresent(){var e=this._viewer.model;return"No product structure"!==e.getNodeName(e.getAbsoluteRootNode())}enablePartSelection(e){this._partSelectionEnabled=e}_initEvents(){var e=()=>{this._reset()};this._viewer.setCallbacks({assemblyTreeReady:()=>{this._onNewModel()},firstModelLoaded:e,hwfParseComplete:e,modelSwitched:e,selectionArray:e=>{this._onPartSelection(e)},incrementalSelectionBatchEnd:()=>{this._updateSelectionTimer.set(50,()=>{this.updateSelection(null)})},visibilityChanged:()=>{this._tree.getVisibilityControl().updateModelTreeVisibilityState()},viewCreated:e=>{this._onNewView(e)},viewLoaded:e=>{this._onNewView(e)},subtreeLoaded:e=>{this._onSubtreeLoaded(e),this._tree.getVisibilityControl().updateModelTreeVisibilityState()},subtreeDeleted:e=>{this._onSubtreeDeleted(e)},modelSwitchStart:()=>{this._tree.clear()},measurementCreated:e=>{this._onNewMeasurement(e)},measurementLoaded:e=>{this._onNewMeasurement(e)},measurementDeleted:e=>{this._onDeleteMeasurement(e)},measurementShown:()=>{this._tree.updateMeasurementVisibilityIcons()},measurementHidden:()=>{this._tree.updateMeasurementVisibilityIcons()},sheetActivated:e=>{e!==this._currentSheetId&&(this._currentSheetId=e,this._refreshModelTree(e))},sheetDeactivated:()=>{this._reset()},configurationActivated:e=>{this._refreshModelTree(e)}}),this._tree.registerCallback("loadChildren",e=>{this._loadNodeChildren(e)}),this._tree.registerCallback("selectItem",(e,t)=>__awaiter(this,void 0,void 0,function*(){yield this._onTreeSelectItem(e,t)}))}_refreshModelTree(e){this._tree.clear();var t=this._viewer.model,i=t.getAbsoluteRootNode(),s=t.getNodeName(i);this._tree.appendTopLevelElement(s,this._partId(i),"modelroot",0<t.getNodeChildren(i).length,!1,!0),this._tree.addChild(t.getNodeName(e),this._partId(e),this._partId(i),"part",!0,h.Desktop.Tree.Model),this._tree.expandInitialNodes(this._partId(i)),this._refreshMarkupViews()}_reset(){this._tree.clear(),this._currentSheetId=null,this._onNewModel()}_onNewModel(){var e=this._viewer.model,t=e.getAbsoluteRootNode(),i=e.getNodeName(t);this.showTab(),this._startedWithoutModelStructure=!this.modelStructurePresent(),this._lastModelRoot=this._tree.appendTopLevelElement(i,this._partId(t),"modelroot",0<e.getNodeChildren(t).length),this._viewer.sheetManager.isDrawingSheetActive()||this._tree.expandInitialNodes(this._partId(t)),this._refreshMarkupViews()}_createMarkupViewFolderIfNecessary(){0===$("#markupviews").length&&this._tree.appendTopLevelElement("Markup Views","markupviews","viewfolder",!1)}_createMeasurementFolderIfNecessary(){0===$("#"+this._measurementFolderId).length&&this._tree.appendTopLevelElement("Measurements",this._measurementFolderId,"measurement",!1)}_parentChildrenLoaded(e){e=this._partId(e);return this._tree.childrenAreLoaded(e)}_onSubtreeLoaded(e){var t,i=this._viewer.model;for(t of e)if(!i.getOutOfHierarchy(t)){let e=i.getNodeParent(t);if(null===e)console.assert(null!==this._lastModelRoot),this._lastModelRoot=this._tree._insertNodeAfter(i.getNodeName(t),this._partId(t),"modelroot",this._lastModelRoot,!0);else{var s=e;do{if(this._parentChildrenLoaded(e)){s===e&&this._tree.addChild(i.getNodeName(t),this._partId(t),this._partId(e),"assembly",!0,h.Desktop.Tree.Model),this._tree.preloadChildrenIfNecessary(this._partId(t));break}}while(t=e,null!==(e=i.getNodeParent(t)))}}this._startedWithoutModelStructure&&(null!==(e=this._tree.getRoot()).firstChild&&e.removeChild(e.firstChild),null!==(e=this._tree.getPartVisibilityRoot()).firstChild)&&e.removeChild(e.firstChild)}_onSubtreeDeleted(e){for(const t of e)this._tree.deleteNode(this._partId(t))}_buildTreePathForNode(e){var t=this._viewer.model,i=[];let s=t.getNodeParent(e);for(;null!==s&&(!this._viewer.sheetManager.isDrawingSheetActive()||null===this._currentSheetId||s!==this._currentSheetId&&e!==this._currentSheetId);)i.push(s),s=t.getNodeParent(s);return i.reverse(),i}_expandCorrectContainerForNodeId(e){var t=this._viewer.model,i=t.getNodeParent(e);null!==i&&0<=(t=t.getNodeChildren(i).indexOf(e))&&(e=Math.floor(t/this._maxNodeChildrenSize),this._tree.expandChildren(this._containerId(i,e)))}_expandPmiFolder(e){e=this._viewer.model.getNodeParent(e);null!==e&&this._tree.expandChildren(this._pmiFolderId(e))}_isInsideContainer(e){var e=this._viewer.model.getNodeParent(e);return null!==e&&(e=this._containerId(e,0),0<$("#"+e).length)}_isInsidePmiFolder(e){var e=this._viewer.model.getNodeParent(e);return null!==e&&(e=this._pmiFolderId(e),0<$("#"+e).length)}_expandPart(e){if(this._viewer.model.isNodeLoaded(e)){for(const i of this._buildTreePathForNode(e)){this._isInsideContainer(i)&&this._expandCorrectContainerForNodeId(i);var t=$("#"+this._partId(i)).attr("id");void 0!==t&&this._tree.expandChildren(t)}this._isInsideContainer(e)&&this._expandCorrectContainerForNodeId(e),this._isInsidePmiFolder(e)&&this._expandPmiFolder(e),this._tree.selectItem(this._partId(e),!1)}}_onPartSelection(e){if(this._partSelectionEnabled){for(const i of e){var t=i.getSelection().getNodeId();null===t?this._tree.selectItem(null,!1):this._expandPart(t)}0===e.length&&this._tree.updateSelection(null)}}_createContainerNodes(e,t){let i=1,s=this._maxNodeChildrenSize,r=0;for(;;){var o=Math.min(s,t.length),o=`Child Nodes ${i} - `+o;if(this._tree.addChild(o,this._containerId(e,r),this._partId(e),"container",!0,h.Desktop.Tree.Model),i+=this._maxNodeChildrenSize,++r,s>=t.length)return;s+=this._maxNodeChildrenSize}}_loadAssemblyNodeChildren(e){var t=this._viewer.model.getNodeChildren(e);t.length>this._maxNodeChildrenSize?this._createContainerNodes(e,t):(e=this._partId(e),this._processNodeChildren(t,e))}_loadContainerChildren(e){var t=this._viewer.model,i=this._splitHtmlId(e),i=this._splitContainerId(i[1]),t=t.getNodeChildren(parseInt(i[0],10)),i=this._maxNodeChildrenSize*parseInt(i[1],10),t=t.slice(i,i+this._maxNodeChildrenSize);this._processNodeChildren(t,e)}_processNodeChildren(e,s){var r=this._viewer.model;let o=null;for(const l of e){var n,a=r.getNodeName(l);let e=s,t="assembly",i=!1;switch(r.getNodeType(l)){case d.NodeType.Body:case d.NodeType.BodyInstance:t="body";break;case d.NodeType.Pmi:null!==(o=null===o&&null!==(n=this._viewer.model.getNodeParent(l))?this._tree.addChild("PMI",this._pmiFolderId(n),s,"modelroot",!0,h.Desktop.Tree.Model,!0,!0):o)&&(e=o.id,t="assembly");break;case d.NodeType.DrawingSheet:this._viewer.sheetManager.isDrawingSheetActive()||(i=!0)}i||this._tree.addChild(a,this._partId(l),e,t,0<r.getNodeChildren(l).length,h.Desktop.Tree.Model)}0<e.length&&this._updateVisibilityStateTimer.set(50,()=>{this._tree.getVisibilityControl().updateModelTreeVisibilityState()})}_loadNodeChildren(e){var t=this._splitHtmlId(e);switch(t[""===t[0]?1:0]){case"part":var i=parseInt(t[1],10);this._loadAssemblyNodeChildren(i);break;case"container":this._loadContainerChildren(e);break;case"markupviews":case"measurementitems":case"pmipart":break;default:console.assert(!1)}}_onTreeSelectItem(s,r=d.SelectionMode.Set){return __awaiter(this,void 0,void 0,function*(){var e=document.getElementById(s);if(null!==e){"LI"===e.tagName&&"markupviews"!==s?e.classList.add("selected"):null!==(t=document.getElementById("markupviews"))&&t.classList.remove("selected"),0===s.lastIndexOf("pmi",0)&&e.classList.contains("ui-modeltree-item")&&e.classList.remove("selected");var t,i=this._splitHtmlId(s);switch(i[0]){case"part":this._viewer.selectPart(parseInt(i[1],10),r);break;case"markupview":yield this._viewer.markupManager.activateMarkupViewWithPromise(i[1]);break;case"container":this._onContainerClick(i[1])}}})}_onContainerClick(e){}_onNewView(e){this._createMarkupViewFolderIfNecessary(),this._addMarkupView(e)}_refreshMarkupViews(){var e=this._viewer.markupManager;for(const i of e.getMarkupViewKeys()){var t=e.getMarkupView(i);null!==t&&this._addMarkupView(t)}}_addMarkupView(e){this._createMarkupViewFolderIfNecessary();var t=this._viewId(e.getUniqueId());this._tree.addChild(e.getName(),t,"markupviews","view",!1,h.Desktop.Tree.Model)}_onNewMeasurement(e){this._createMeasurementFolderIfNecessary();var t=this._measurementId(e._getId());this._tree.addChild(e.getName(),t,this._measurementFolderId,"measurement",!1,h.Desktop.Tree.Model),this._updateMeasurementsFolderVisibility(),this._tree.updateMeasurementVisibilityIcons()}_onDeleteMeasurement(e){e=this._measurementId(e._getId());this._tree.deleteNode(e),this._tree.deleteNode("visibility"+i.separator+e),this._updateMeasurementsFolderVisibility()}_updateMeasurementsFolderVisibility(){var e=this._viewer.measureManager.getAllMeasurements(),t=document.getElementById(this._measurementFolderId),t=(null!==t&&(t.style.display=e.length?"inherit":"none"),document.getElementById("visibility"+i.separator+this._measurementFolderId));null!==t&&(t.style.display=e.length?"inherit":"none")}_measurementId(e){return"measurement"+i.separator+e}_partId(e){return"part"+i.separator+e}_pmiFolderId(e){return"pmipartfolder"+i.separator+e}_viewId(e){return"markupview"+i.separator+e}_containerId(e,t){return console.assert(0<=t),`container${i.separator}${e}-`+t}_splitContainerId(e){return this._splitHtmlIdParts(e,"-")}updateSelection(e){this._tree.updateSelection(e)}}h.ModelTree=i}}(Communicator=Communicator||{}),function(i){{var l=i.Ui||(i.Ui={});class d extends l.ViewTree{constructor(e,t,i){super(e,t,i),this._currentNodeId=0,this._currentBimNodeId="0",this._tree.setCreateVisibilityItems(!1),this._initEvents()}_initEvents(){var e=()=>{this._onNewModel()};this._viewer.setCallbacks({firstModelLoaded:e,modelSwitched:e,subtreeLoaded:e,selectionArray:e=>__awaiter(this,void 0,void 0,function*(){yield this._onTreeSelectItem(e)})}),this._tree.registerCallback("loadChildren",e=>{this._loadNodeChildren(e)}),this._tree.registerCallback("selectItem",e=>__awaiter(this,void 0,void 0,function*(){yield this._onclickItemButton(e)})),this._tree.registerCallback("clickItemButton",e=>__awaiter(this,void 0,void 0,function*(){yield this._onSelectRelationships(e)}))}_onTreeSelectItem(s){return __awaiter(this,void 0,void 0,function*(){for(const i of s){var e,t=i.getSelection().getNodeId();null===t?this._tree.selectItem(null,!1):null!==(e=this._viewer.model.getBimIdFromNode(t))&&(this._currentNodeId=t,this._currentBimNodeId=e,this._update())}})}_translateTypeRelationshipToString(e){let t="Type Unknown";return t=e!==i.RelationshipType.Undefined?i.RelationshipType[e]:t}_translateStringTypeToRelationshipType(e){let t=i.RelationshipType.Undefined;switch(e){case"ContainedInSpatialStructure":t=i.RelationshipType.ContainedInSpatialStructure;break;case"FillsElement":t=i.RelationshipType.FillsElement;break;case"Aggregates":t=i.RelationshipType.Aggregates;break;case"VoidsElement":t=i.RelationshipType.VoidsElement;break;case"SpaceBoundary":t=i.RelationshipType.SpaceBoundary;break;case"ConnectsPathElements":t=i.RelationshipType.ConnectsPathElements;break;default:t=i.RelationshipType.Undefined}return t}static _createIdNode(e){return""+d.RelationshipPartPrefix+d.separator+e+d.separator+ ++this._idCount}static _createIdType(){return""+d.RelationshipTypePrefix+d.separator+ ++this._idCount}static getRelationshipTypeName(e){return this._idNameMap.get(e)||null}static getRelationshipTypeId(e){return this._nameIdMap.get(e)||null}_onNewModel(){var e=this._viewer.model;this._tree.clear(),this._currentNodeId=e.getAbsoluteRootNode(),this._currentBimNodeId=this._currentNodeId.toString()}_update(){this._tree.clear();for(const i of this._viewer.model.getRelationshipTypesFromBimId(this._currentNodeId,this._currentBimNodeId)){var e=d._createIdType(),t=this._translateTypeRelationshipToString(i);d._idNameMap.set(e,t),d._nameIdMap.set(t,e),this._tree.appendTopLevelElement(t,e,"assembly",!0,!1)}}_loadNodeChildren(e){var t,e=d.getRelationshipTypeName(e);null!==e&&null!==(t=d.getRelationshipTypeId(e))&&this._addRelationships(t,e)}_addRelationships(t,e){e=this._translateStringTypeToRelationshipType(e),e=this._viewer.model.getBimIdConnectedElements(this._currentNodeId,this._currentBimNodeId,e);for(const n of e.relatings){var i=n;let e='<button class="ui-model-tree-relationships-button" type="button" id="buttonRight"><b>←</b></button>';var s=d._createIdNode(n),i=this._viewer.model.getBimInfoFromBimId(this._currentNodeId,i);d._idNameMap.set(s,i.name),d._idNameMap.set(i.name,s),e=(e=e.concat(" ")).concat(i.name),this._tree.addChild(e,s,t,"assembly",!1,l.Desktop.Tree.Relationships,i.connected)}for(const a of e.relateds){var r=a;let e='<button class="ui-model-tree-relationships-button" type="button" id="buttonRight"><b>→</b> </button>';var o=d._createIdNode(a),r=this._viewer.model.getBimInfoFromBimId(this._currentNodeId,r);d._idNameMap.set(o,r.name),d._idNameMap.set(r.name,o),e=(e=e.concat(" ")).concat(r.name),this._tree.addChild(e,o,t,"assembly",!1,l.Desktop.Tree.Relationships,r.connected)}}_onclickItemButton(t){return __awaiter(this,void 0,void 0,function*(){var e=document.getElementById(t);if(null!==e){var e=this._splitHtmlId(t);if(0<e.length){const t=this._splitHtmlIdParts(e[0],d.separator);t[0]===d.RelationshipPartPrefix&&null!==(e=this._viewer.model.getNodeIdFromBimId(this._currentNodeId,t[1]))&&(this._viewer.model.resetModelHighlight(),this._viewer.model.setNodesHighlighted([e],!0))}}})}_onSelectRelationships(t){return __awaiter(this,void 0,void 0,function*(){var e=this._splitHtmlId(t);if(0<e.length){const t=this._splitHtmlIdParts(e[0],d.separator);t[0]===d.RelationshipPartPrefix&&(e=this._viewer.model.getNodeIdFromBimId(this._currentNodeId,t[1]),this._viewer.selectPart(e,i.SelectionMode.Set))}})}}d.RelationshipPrefix="relships",d.RelationshipTypePrefix="relshipsType",d.RelationshipPartPrefix="relshipsPart",d._idCount=0,d._nameIdMap=new Map,d._idNameMap=new Map,l.RelationshipsTree=d}}(Communicator=Communicator||{}),function(i){{var s=i.Ui||(i.Ui={});class e extends s.ViewTree{constructor(e,t,i){super(e,t,i),this._currentSheetId=null,this._3dSheetId=""+this._internalId+s.ViewTree.separator+"3D",this._tree.setCreateVisibilityItems(!1),this._initEvents()}_initEvents(){var e=()=>{this._onNewModel()};this._viewer.setCallbacks({assemblyTreeReady:e,firstModelLoaded:e,modelSwitched:e,sheetActivated:e=>{this._onSheetActivated(e)},sheetDeactivated:()=>{this._onSheetDeactivated()}}),this._tree.registerCallback("selectItem",e=>__awaiter(this,void 0,void 0,function*(){yield this._onTreeSelectItem(e)}))}_setCurrentSheetId(e){var t=$("#"+this._currentSheetId),t=(null!==t&&t.removeClass("selected-sheet"),$("#"+e));null!==t&&t.addClass("selected-sheet"),this._currentSheetId=e}_onNewModel(){if(this._tree.clear(),this._viewer.model.isDrawing()){var e=this._viewer.model;for(const s of this._viewer.sheetManager.getSheetIds()){var t=e.getNodeName(s),i=this._sheetTreeId(s);this._tree.appendTopLevelElement(t,i,"sheet",!1)}0<this._viewer.sheetManager.get3DNodes().length&&(this._tree.appendTopLevelElement("3D Model",this._3dSheetId,"sheet",!1,!1,!1),this._currentSheetId=this._3dSheetId),this.showTab()}else this.hideTab()}_onSheetActivated(e){this._setCurrentSheetId(this._sheetTreeId(e))}_onSheetDeactivated(){this._setCurrentSheetId(this._3dSheetId)}_onTreeSelectItem(t){return __awaiter(this,void 0,void 0,function*(){var e;return t===this._3dSheetId?this._viewer.sheetManager.deactivateSheets():(e=this._splitHtmlId(t),e=parseInt(e[1],10),this._currentSheetId===this._3dSheetId&&(this._viewer.model.setViewAxes(new i.Point3(0,0,1),new i.Point3(0,1,0)),yield this._viewer.setViewOrientation(i.ViewOrientation.Front,0)),this._viewer.sheetManager.setActiveSheetId(e))})}_sheetTreeId(e){return""+this._internalId+s.ViewTree.separator+e}}s.SheetsTree=e}}(Communicator=Communicator||{}),function(h){var c=h.Ui||(h.Ui={});{var e=c.Control||(c.Control={});class r{constructor(e){this.nodeId=null,this.guid=null,"number"==typeof e?this.nodeId=e:this.guid=e}}class o{constructor(e){this._fullHiddenParentIds=[],this._partialHiddenParentIds=[],this._assemblyTreeReadyOccurred=!1,this._viewer=e;const t=()=>(this.updateModelTreeVisibilityState(),Promise.resolve());this._viewer.setCallbacks({_assemblyTreeReady:()=>(this._assemblyTreeReadyOccurred=!0,t()),firstModelLoaded:t})}_clearStyles(){for(const e of this._fullHiddenParentIds)this._removeVisibilityHiddenClass(e,"partHidden");this._fullHiddenParentIds.length=0;for(const t of this._partialHiddenParentIds)this._removeVisibilityHiddenClass(t,"partialHidden");this._partialHiddenParentIds.length=0}_applyStyles(){for(const e of this._fullHiddenParentIds)this._addVisibilityHiddenClass(e,"partHidden");for(const t of this._partialHiddenParentIds)this._addVisibilityHiddenClass(t,"partialHidden")}updateModelTreeVisibilityState(){if(this._assemblyTreeReadyOccurred){this._clearStyles();var e=this._viewer.model,t=[e.getAbsoluteRootNode()];for(const s of t){var i=e.getBranchVisibility(s);if(i===h.BranchVisibility.Hidden)this._fullHiddenParentIds.push(s);else if(i===h.BranchVisibility.Mixed){this._partialHiddenParentIds.push(s);for(const r of e.getNodeChildren(s))t.push(r)}}this._applyStyles()}}_getVisibilityItem(e){return $(`#visibility${c.ViewTree.separator}part`+c.ViewTree.separator+e)}_addVisibilityHiddenClass(e,t){this._getVisibilityItem(e).addClass(t)}_removeVisibilityHiddenClass(e,t){this._getVisibilityItem(e).removeClass(t)}}e.VisibilityControl=o;class t{constructor(e,t,i,s){this._lastItemId=null,this._selectedPartItems=[],this._futureHighlightIds=new Set,this._futureMixedIds=new Set,this._selectedItemsParentIds=[],this._selectedLayers=[],this._mixedItemsLayer=new Set,this._selectedTypes=[],this._futureMixedTypesIds=[],this._mixedTypes=new Set,this._callbacks=new Map,this._childrenLoaded=new Set,this._loadedNodes=new Set,this._touchTimer=new h.Util.Timer,this._freezeExpansion=!1,this._scrollTimer=new h.Util.Timer,this._selectionLabelHighlightTimer=new h.Util.Timer,this._createVisibilityItems=!0,this._elementId=e,this._viewer=t,this._treeScroll=s,this._separator=i,this._visibilityControl=new o(t),this._partVisibilityRoot=document.createElement("ul"),this._listRoot=document.createElement("ul"),this._init()}setCreateVisibilityItems(e){this._createVisibilityItems=e}getElementId(){return this._elementId}getRoot(){return this._listRoot}getPartVisibilityRoot(){return this._partVisibilityRoot}getVisibilityControl(){return this._visibilityControl}registerCallback(e,t){this._callbacks.has(e)||this._callbacks.set(e,[]),this._callbacks.get(e).push(t)}_triggerCallback(e,...t){e=this._callbacks.get(e);if(e)for(const i of e)i.apply(null,t)}deleteNode(e){e="#"===e.charAt(0)?e.slice(1):e;jQuery("#"+e).remove(),jQuery("#visibility"+this._separator+e).remove()}_getTaggedId(e,t,i){var s="Annotation Views";return null!==i&&i===s&&t===c.Desktop.Tree.CadView?new r(s):this._parseTaggedId(e)}addChild(e,t,i,s,r,o,n=!0,a=!1){var l=this._getTaggedId(t,o,e);if(null===l)return null;if(o===c.Desktop.Tree.Model&&"container"!==s&&null!==l.nodeId){if(this._loadedNodes.has(l.nodeId)&&!a)return null;this._loadedNodes.add(l.nodeId)}null===e&&(e="unnamed"),this._addVisibilityToggleChild(t,i,s);a=jQuery("#"+i),a.children(".ui-modeltree-container").children(".ui-modeltree-expandNode").css("visibility","visible"),i=a.children("ul");let d=!1,h=!1;null!==l.nodeId&&(d=this._futureHighlightIds.has(l.nodeId),h=this._futureMixedIds.has(l.nodeId),d&&this._futureHighlightIds.delete(l.nodeId),h)&&this._futureMixedIds.delete(l.nodeId);l=this._buildNode(e,t,s,r,d,h,n,o===c.Desktop.Tree.Relationships);return(0===i.length?((e=document.createElement("ul")).classList.add("ui-modeltree-children"),a.append(e),e):i.get(0)).appendChild(l),d&&null!==(s=this._getListItem(t))&&this._selectedPartItems.push(s),this._triggerCallback("addChild"),l}_addVisibilityToggleChild(e,t,i){var t=jQuery("#visibility"+this._separator+t),s=(t.children(".ui-modeltree-visibility-container").css("visibility","visible"),t.children("ul"));let r;0===s.length?((r=document.createElement("ul")).classList.add("ui-modeltree-visibility-children"),t.append(r)):r=s.get(0);t=this._buildPartVisibilityNode(e,i);null!==t&&r.appendChild(t)}_buildPartVisibilityNode(t,i){if(!this._createVisibilityItems)return null;var s=document.createElement("div"),r=(s.classList.add("ui-modeltree-partVisibility-icon"),document.createElement("li"));if(r.classList.add("ui-modeltree-item"),r.classList.add("visibility"),r.id=""+c.ViewTree.visibilityPrefix+c.ViewTree.separator+t,r.appendChild(s),"measurement"!==i){let e;s=t.split(this._separator).pop();if(void 0===(e=void 0!==s?parseInt(s,10):e)||isNaN(e))return r;i=this._viewer.model.getNodeType(e);i!==h.NodeType.Pmi&&i!==h.NodeType.PmiBody||(r.style.visibility="hidden")}return r}freezeExpansion(e){this._freezeExpansion=e}updateSelection(e){e=(e=null===e?this._viewer.selectionManager.getResults():e).map(e=>{if(e instanceof h.Event.NodeSelectionEvent){var t=e.getSelection();if(!t.isNodeSelection())return console.assert(!1),h.InvalidNodeId;e=t}return e.getNodeId()});this._updateTreeSelectionHighlight(e),this._doUnfreezeSelection(e)}collapseAllChildren(e){this._freezeExpansion||($(`#${e} .ui-modeltree-children`).hide(),$(`#${e} .ui-modeltree-visibility-children`).hide(),$(`#${e} .expanded`).removeClass("expanded"))}_expandChildren(e,t){var i=$("#"+e);this.preloadChildrenIfNecessary(e),this._freezeExpansion&&!t||(0<i.length&&(i.children(".ui-modeltree-children").show(),i.children(".ui-modeltree-container").children(".ui-modeltree-expandNode").addClass("expanded")),this._expandVisibilityChildren(e))}expandChildren(e){this._expandChildren(e,!1)}_expandVisibilityChildren(e){var e=$("#visibility"+(this._separator+e));0<e.length&&((e=e.children(".ui-modeltree-visibility-children")).addClass("visible"),e.show())}collapseChildren(e){this._collapseVisibilityChildren(e);e=$("#"+e);0<e.length&&e.children(".ui-modeltree-children").hide()}_collapseVisibilityChildren(e){e=$("#visibility"+this._separator+e);0<e.length&&e.children(".ui-modeltree-visibility-children").hide()}_buildNode(e,t,i,s,r=!1,o=!1,n=!0,a=!1){var l=document.createElement("li"),r=(l.classList.add("ui-modeltree-item"),r&&l.classList.add("selected"),o&&l.classList.add("mixed"),l.id=t,document.createElement("div")),o=(r.classList.add("ui-modeltree-container"),r.style.whiteSpace="nowrap",document.createElement("div")),t=(o.classList.add("ui-modeltree-expandNode"),s||(o.style.visibility="hidden"),r.appendChild(o),document.createElement("div")),s=(t.classList.add("ui-modeltree-icon"),t.classList.add(i),r.appendChild(t),document.createElement("div")),o=(!1===a?n&&s.classList.add("ui-modeltree-label"):n?s.classList.add("ui-modeltree-relationships-label"):s.classList.add("ui-modeltree-relationships-label_unaccess"),s.innerHTML=e,s.title=e,r.appendChild(s),document.createElement("div"));return o.classList.add("ui-mixedselection-icon"),r.appendChild(o),l.appendChild(r),l}childrenAreLoaded(e){return this._childrenLoaded.has(e)}preloadChildrenIfNecessary(e){null===e||this._childrenLoaded.has(e)||(this._triggerCallback("loadChildren",e),this._childrenLoaded.add(e))}_processExpandClick(e){var e=jQuery(e.target),t=e.parents(".ui-modeltree-item").get(0).id;e.hasClass("expanded")?this._collapseListItem(t):this._expandListItem(t)}_collapseListItem(e){this.collapseChildren(e),$("#"+e).find(".ui-modeltree-expandNode").first().removeClass("expanded"),this._triggerCallback("collapse",e)}_expandListItem(e){this.expandChildren(e),$("#"+e).find(".ui-modeltree-expandNode").first().addClass("expanded"),this._triggerCallback("expand",e)}selectItem(e,t=!0){this._doSelection(e,t)}highlightItem(e,t=!0){this._doHighlight(e,t)}_getListItem(e){e=$(this._listRoot).find("#"+e);return 0<e.length?e:null}_updateNonSelectionHighlight(e){void 0!==this._$lastNonSelectionItem&&this._$lastNonSelectionItem.removeClass("selected"),e.addClass("selected"),this._$lastNonSelectionItem=e}_doUnfreezeSelection(e){for(const s of e){var t=this._viewer.model.getNodeParent(s),i=this._getListItem("part"+c.ViewTree.separator+s),t=(null===i||i.hasClass("selected")?null===i&&this._futureHighlightIds.add(s):(i.addClass("selected"),this._selectedPartItems.push(i)),null!==t&&(null!==(i=c.LayersTree.getLayerPartId(t))&&(null===(i=this._getListItem(i))||i.hasClass("selected")?null===i&&this._futureHighlightIds.add(t):(i.addClass("selected"),this._selectedPartItems.push(i))),null===(i=this._getListItem(c.TypesTree.getComponentPartId(t)))||i.hasClass("selected")||(i.addClass("selected"),this._selectedPartItems.push(i))),this._getListItem(c.TypesTree.getComponentPartId(s)));null===t||t.hasClass("selected")||(t.addClass("selected"),this._selectedPartItems.push(t))}}_doSelection(t,i=!0){if(null!==t){var s=t.split(this._separator),r="part"===s[0],o="layerpart"===s[0],n="typespart"===s[0],a=$("#"+t);let e=!1;if(r||o||n){a.addClass("selected");for(const d of this._selectedPartItems){var l=d.get(0);if(void 0!==l&&t===l.id){e=!0;break}}e||this._selectedPartItems.push(a)}else if(0!==t.lastIndexOf("sheet",0)){if(0===t.lastIndexOf("container",0))return;if(s[0]===c.LayersTree.layerPartContainerPrefix)return;this._updateNonSelectionHighlight(a)}i&&(this._lastItemId=t,r="undefined"!=typeof key&&(key.ctrl||key.command),o=e&&1===this._selectedPartItems.length,n=r||o?h.SelectionMode.Toggle:h.SelectionMode.Set,this._triggerCallback("selectItem",t,n)),this._lastItemId===t||this._freezeExpansion||i||this._scrollToItem(a)}this._lastItemId=t,this._selectionLabelHighlightTimer.set(30,()=>{var e=this._viewer.selectionManager.getResults().map(e=>e.getNodeId());this._updateTreeSelectionHighlight(e)})}_doHighlight(e,t=!0){var i=$("#"+e);this._updateNonSelectionHighlight(i),t&&null!==e&&this._triggerCallback("selectItem",e,h.SelectionMode.Set)}_doSelectIfcItem(e,t=!0){var i=$("#"+e);this._updateNonSelectionHighlight(i),t&&null!==e&&this._triggerCallback("clickItemButton",e)}_scrollToItem(i){this._scrollTimer.set(t._ScrollToItemDelayMs,()=>{var e=i.offset(),t=$("#modelTreeContainer").innerHeight();void 0!==e&&void 0!==t&&((e=e.top)<6||t<e)&&(this._scrollTimer.clear(),this._treeScroll)&&(this._treeScroll.refresh(),this._treeScroll.scrollToElement(i.get(0),c.DefaultUiTransitionDuration,!0,!0))})}_parseTaggedId(e){var t=this._parseUuid(e);return null!==t||null!==(t=this._parseNodeId(e))?new r(t):null}_parseNodeId(e){e=e.split(this._separator);if(!(e.length<2||"measurement"===e[0]||"markupview"===e[0])){e=e[e.length-1];if(void 0!==e){e=parseInt(e,10);if(!isNaN(e))return e}}return null}_parseUuid(e){e=e.split(this._separator).pop();return void 0!==e&&36===e.length?e:null}_parseMeasurementId(e){return e.split(this._separator).pop()}_parseVisibilityLayerName(e){e=e.split(""+c.ViewTree.visibilityPrefix+c.ViewTree.separator);return 2!==e.length?null:c.LayersTree.getLayerName(e[1])}_parseVisibilityLayerNodeId(e){e=e.split(""+c.ViewTree.visibilityPrefix+c.ViewTree.separator);return 2!==e.length?null:c.LayersTree.getPartId(e[1])}_updateLayerTreeSelectionHighlight(e){for(const t of this._selectedLayers)$("#"+c.LayersTree.getLayerId(t)).removeClass("selected");this._mixedItemsLayer.forEach(e=>{e=this._viewer.model.getLayerName(e);null!==e&&$("#"+c.LayersTree.getLayerId(e)).addClass("mixed")}),this._selectedLayers=this._viewer.selectionManager.getSelectedLayers();for(const i of this._selectedLayers)$("#"+c.LayersTree.getLayerId(i)).addClass("selected"),$("#"+c.LayersTree.getLayerId(i)).removeClass("mixed");for(const s of e)$("#"+c.LayersTree.getLayerPartId(s)).addClass("selected")}_addMixedTypeClass(e){e=this._viewer.model.getNodeGenericType(e);return null!==e&&!this._mixedTypes.has(e)&&($("#"+c.TypesTree.getGenericTypeId(e)).addClass("mixed"),this._mixedTypes.add(e),!0)}_updateTypesTreeSelectionHighlight(){for(const i of this._selectedTypes)$("#"+c.TypesTree.getGenericTypeId(i)).removeClass("selected");for(const s of this._futureMixedTypesIds){var e;this._addMixedTypeClass(s)||null!==(e=this._viewer.model.getNodeParent(s))&&this._addMixedTypeClass(e)}this._selectedTypes=this._viewer.selectionManager.getSelectedTypes();for(const r of this._selectedTypes){var t=$("#"+c.TypesTree.getGenericTypeId(r));t.addClass("selected"),t.removeClass("mixed")}}_updateTreeSelectionHighlight(t){this._futureHighlightIds.forEach(e=>{0<=t.indexOf(e)&&this._futureHighlightIds.delete(e)});for(const i of this._selectedItemsParentIds)$("#part"+c.ViewTree.separator+i).removeClass("mixed");this._selectedItemsParentIds.length=0,this._futureMixedIds.clear(),this._mixedItemsLayer.forEach(e=>{e=this._viewer.model.getLayerName(e);null!==e&&$("#"+c.LayersTree.getLayerId(e)).removeClass("mixed")}),this._mixedItemsLayer.clear(),this._mixedTypes.forEach(e=>{$("#"+c.TypesTree.getGenericTypeId(e)).removeClass("mixed")}),this._mixedTypes.clear(),this._futureMixedTypesIds=[],h.Util.filterInPlace(this._selectedPartItems,e=>{e=e.get(0);if(void 0!==e){var e=this._parseNodeId(e.id);if(null===e)return!1;if(t.indexOf(e)<0)return $("#part"+c.ViewTree.separator+e).removeClass("selected"),$("#typespart"+c.ViewTree.separator+e).removeClass("selected"),(e=c.LayersTree.getLayerPartId(e))&&$("#"+e).removeClass("selected"),!1}return!0});for(const s of t)this._updateParentIdList(s),this._updateMixedLayers(s),this._updateMixedTypes(s);for(const r of this._selectedItemsParentIds){var e=this._getListItem("part"+c.ViewTree.separator+r);null===e||e.hasClass("mixed")?this._futureMixedIds.add(r):e.addClass("mixed")}this._updateLayerTreeSelectionHighlight(t),this._updateTypesTreeSelectionHighlight()}_updateParentIdList(t){var i=this._viewer.model;if(i.isNodeLoaded(t)){let e=i.getNodeParent(t);for(;null!==e&&-1===this._selectedItemsParentIds.indexOf(e);)this._selectedItemsParentIds.push(e),e=i.getNodeParent(e)}}_updateMixedLayers(e){var t=e=>{e=this._viewer.model.getNodeLayerId(e);null!==e&&this._mixedItemsLayer.add(e)};for(const i of this._viewer.model.getNodeChildren(e))t(i);t(e)}_updateMixedTypes(e){this._futureMixedTypesIds.push(e)}_processLabelContext(e,t){var i=jQuery(e.target).closest(".ui-modeltree-item"),e=(t=t||new h.Point2(e.clientX,e.clientY),i.get(0).id);this._triggerCallback("context",e,t)}_processLabelClick(e){e=jQuery(e.target).closest(".ui-modeltree-item");this._doSelection(e.get(0).id,!0)}_processLabelRSClick(e){e=jQuery(e.target).closest(".ui-modeltree-item");this._doHighlight(e.get(0).id,!0)}_processLabelRSClickButton(e){e=jQuery(e.target).closest(".ui-modeltree-item");this._doSelectIfcItem(e.get(0).id,!0)}appendTopLevelElement(e,t,i,s,r=!0,o=!1){e=this._buildNode(e=null===e?"unnamed":e,t,i,s),"part"===t.substring(0,4)&&this._listRoot.firstChild?this._listRoot.insertBefore(e,this._listRoot.firstChild):this._listRoot.appendChild(e),s=this._buildPartVisibilityNode(t,i);return null!==s&&this._partVisibilityRoot.appendChild(s),r&&this.preloadChildrenIfNecessary(t),o&&this._childrenLoaded.add(t),e}insertNodeAfter(e,t,i,s,r){return this._insertNodeAfter(e,t,i,s,r)}_insertNodeAfter(e,t,i,s,r){if(null===e&&(e="unnamed"),null===s.parentNode)throw new h.CommunicatorError("element.parentNode is null");e=this._buildNode(e,t,i,r);return s.nextSibling?s.parentNode.insertBefore(e,s.nextSibling):s.parentNode.appendChild(e),this.preloadChildrenIfNecessary(t),e}clear(){for(;this._listRoot.firstChild;)this._listRoot.removeChild(this._listRoot.firstChild);for(;this._partVisibilityRoot.firstChild;)this._partVisibilityRoot.removeChild(this._partVisibilityRoot.firstChild);this._childrenLoaded.clear(),this._loadedNodes.clear()}expandInitialNodes(e){let t=e,i=[];for(;i.length<=1&&0!==(i=this._getChildItemsFromModelTreeItem($("#"+t))).length;)this._expandChildren(t,!0),t=i[0].id,this.preloadChildrenIfNecessary(t)}_processVisibilityClick(e){return __awaiter(this,void 0,void 0,function*(){switch(e.split(this._separator)[1]){case"part":return this._processPartVisibilityClick(e);case"measurement":return this._processMeasurementVisibilityClick(e);case"layer":return this._processLayerVisibilityClick(e);case"layerpart":return this._processLayerPartVisibilityClick(e);case"types":return this._processTypesVisibilityClick(e);case"typespart":return this._processTypesPartVisibilityClick(e)}})}_processPartVisibilityClick(t){return __awaiter(this,void 0,void 0,function*(){var e=this._parseNodeId(t);null!==e&&(yield this._processPartVisibility(e))})}_processPartVisibility(s){return __awaiter(this,void 0,void 0,function*(){var e=this._viewer.model,t=e.getNodeVisibility(s),i=e.hasEffectiveGenericType(s,h.StaticGenericType.IfcSpace);yield e.setNodesVisibility([s],!t,!i&&null)})}_processMeasurementVisibilityClick(t){var e,i=this._parseMeasurementId(t),t=this._viewer.measureManager.getAllMeasurements();if("measurementitems"===i){let e=!0;for(const s of t)if(s.getVisibility()){e=!1;break}for(const r of t)r.setVisibility(e)}else for(const o of t)i===o._getId()&&(e=o.getVisibility(),o.setVisibility(!e))}_processTypesVisibilityClick(t){return __awaiter(this,void 0,void 0,function*(){var e=t.split(this._separator).pop();void 0!==e&&(yield this._processTypesVisibility(e))})}_processTypesVisibility(r){return __awaiter(this,void 0,void 0,function*(){const t=this._viewer.model;let i=!1;var e=t.getNodesByGenericType(r);if(null!==e){const s=[];e.forEach(e=>{i=i||t.getNodeVisibility(e),s.push(e)}),yield t.setNodesVisibility(s,!i,r!==h.StaticGenericType.IfcSpace&&null),this.updateTypesVisibilityIcons()}})}_processTypesPartVisibilityClick(t){return __awaiter(this,void 0,void 0,function*(){var e=this._parseNodeId(t);null!==e&&(yield this._processTypesPartVisibility(e))})}_processTypesPartVisibility(s){return __awaiter(this,void 0,void 0,function*(){var e=this._viewer.model,t=yield e.getNodeVisibility(s),i=e.hasEffectiveGenericType(s,h.StaticGenericType.IfcSpace);yield e.setNodesVisibility([s],!t,!i&&null)})}updateTypesVisibilityIcons(){const r=this._viewer.model;r.getGenericTypeIdMap().forEach((e,t)=>{let i=!1,s=!1;e.forEach(e=>{var t=$("#visibility"+c.ViewTree.separator+c.TypesTree.getComponentPartId(e));t.removeClass("partHidden"),r.getNodeVisibility(e)?s=!0:(i=!0,t.addClass("partHidden"))});e=$("#visibility"+c.ViewTree.separator+c.TypesTree.getGenericTypeId(t));e.removeClass(["partHidden","partialHidden"]),i&&s?e.addClass("partialHidden"):i&&e.addClass("partHidden")})}_processLayerVisibilityClick(t){return __awaiter(this,void 0,void 0,function*(){var e=this._parseVisibilityLayerName(t);if(e){let t=!1;var i=this._viewer.model.getNodesFromLayerName(e,!0);if(null!==i){for(let e=0;e<i.length&&!(t=t||this._viewer.model.getNodeVisibility(i[e]));++e);h._filterActiveSheetNodeIds(this._viewer,i),0<i.length&&(yield this._viewer.model.setNodesVisibility(i,!t,null))}}})}_processLayerPartVisibilityClick(i){return __awaiter(this,void 0,void 0,function*(){var e,t=this._parseVisibilityLayerNodeId(i);null!==t&&(e=this._viewer.model.getNodeVisibility(t),h._filterActiveSheetNodeIds(this._viewer,t=[t]),0<t.length)&&(yield this._viewer.model.setNodesVisibility(t,!e,null))})}updateLayersVisibilityIcons(){this._viewer.model.getUniqueLayerNames().forEach(e=>{var r,o=this._viewer.model.getNodesFromLayerName(e,!0);if(null!==o){let i=!1,s=!1;for(let t=0;t<o.length;++t){let e=o[t];null!==(e=this._viewer.model.isDrawing()?e:this._viewer.model.getNodeParent(o[t]))&&((r=$("#visibility"+c.ViewTree.separator+c.LayersTree.getLayerPartId(e))).removeClass("partHidden"),this._viewer.model.getNodeVisibility(o[t])?s=!0:(i=!0,r.addClass("partHidden")))}e=$("#visibility"+c.ViewTree.separator+c.LayersTree.getLayerId(e));e.removeClass(["partHidden","partialHidden"]),i&&s?e.addClass("partialHidden"):i&&e.addClass("partHidden")}})}updateMeasurementVisibilityIcons(){var e=this._viewer.measureManager.getAllMeasurements();let t=0;for(const o of e){var i=o.getVisibility(),s=$(`#visibility${c.ViewTree.separator}measurement`+c.ViewTree.separator+o._getId());i?s.removeClass("partHidden"):(t++,s.addClass("partHidden"))}var r=$(`#visibility${c.ViewTree.separator}measurementitems`);t===e.length?(r.removeClass("partialHidden"),r.addClass("partHidden")):0<t&&t<e.length?(r.removeClass("partHidden"),r.addClass("partialHidden")):(r.removeClass("partialHidden"),r.removeClass("partHidden")),this._viewer.markupManager.updateLater()}_init(){var e=document.getElementById(this._elementId);if(null===e)throw new h.CommunicatorError("container is null");this._partVisibilityRoot.classList.add("ui-visibility-toggle"),e.appendChild(this._partVisibilityRoot),this._listRoot.classList.add("ui-modeltree"),this._listRoot.classList.add("ui-modeltree-item"),e.appendChild(this._listRoot),$(e).on("click",".ui-modeltree-label",e=>{this._processLabelClick(e)}),$(e).on("click",".ui-modeltree-relationships-label",e=>{this._processLabelRSClick(e)}),$(e).on("click",".ui-model-tree-relationships-button",e=>{this._processLabelRSClickButton(e)}),$(e).on("click",".ui-modeltree-expandNode",e=>{this._processExpandClick(e)}),$(e).on("click",".ui-modeltree-partVisibility-icon",t=>__awaiter(this,void 0,void 0,function*(){var e=jQuery(t.target).closest(".ui-modeltree-item")[0].id;yield this._processVisibilityClick(e)})),$(e).on("click","#contextMenuButton",e=>{this._processLabelContext(e)}),$(e).on("mouseup",".ui-modeltree-label, .ui-modeltree-icon",e=>{2===e.button&&this._processLabelContext(e)}),$(e).on("touchstart",i=>{this._touchTimer.set(1e3,()=>{var e=i.originalEvent,t=e.touches[0].pageX,e=e.touches[0].pageY,t=new h.Point2(t,e);this._processLabelContext(i,t)})}),$(e).on("touchmove",e=>{this._touchTimer.clear()}),$(e).on("touchend",e=>{this._touchTimer.clear()}),$(e).on("contextmenu",".ui-modeltree-label",e=>{e.preventDefault()})}_getChildItemsFromModelTreeItem(e){e=e.children(".ui-modeltree-children").children(".ui-modeltree-item");return $.makeArray(e)}}t._ScrollToItemDelayMs=10,e.TreeControl=t}}(Communicator=Communicator||{}),function(a){{var l=a.Ui||(a.Ui={});function i(e){return"IFC"===e.substr(0,3)}class d{constructor(e,t){this.genericType=e,this.index=t}}class h extends l.ViewTree{constructor(e,t,i){super(e,t,i),this._containerMap=new Map,this._initEvents()}_initEvents(){var e=()=>this._onNewModel();this._viewer.setCallbacks({modelStructureReady:e,modelLoaded:e,selectionArray:e=>{this._tree.updateSelection(e)},visibilityChanged:()=>{this._tree.updateTypesVisibilityIcons()}}),this._tree.registerCallback("selectItem",(e,t)=>{this._onTreeSelectItem(e,t)}),this._tree.registerCallback("loadChildren",e=>{this._loadNodeChildren(e)})}_onTreeSelectItem(e,t=a.SelectionMode.Set){null!==document.getElementById(e)&&(i(e=this._splitHtmlId(e)[1])?this._selectIfcComponent(e,t):this._viewer.selectPart(parseInt(e,10),t))}_loadNodeChildren(e){switch(this._splitHtmlId(e)[0]){case"typespart":return;case"types":this._loadGenericTypeChildren(e);break;case"container":this._loadContainerChildren(e)}}_loadGenericTypeChildren(t){var e=this._splitHtmlId(t)[1],i=this._ifcNodesMap.get(e);void 0!==i&&(i.size>this._maxNodeChildrenSize?this._createContainerNodes(t,e):i.forEach(e=>{this._addChildPart(e,t)}))}_loadContainerChildren(e){var t=this._splitHtmlId(e)[1],t=this._containerMap.get(t);if(void 0!==t){var i=t.genericType,t=t.index,i=this._ifcNodesMap.get(i);if(void 0!==i){var t=t*this._maxNodeChildrenSize,s=i.size-t<this._maxNodeChildrenSize?i.size:t+this._maxNodeChildrenSize;for(const r of a.Util.setToArray(i).slice(t,s))this._addChildPart(r,e)}}}_addChildPart(e,t){var i=h.getComponentPartId(e),e=this._viewer.model.getNodeName(e);this._tree.addChild(e,i,t,"part",!1,l.Desktop.Tree.Types)}_createContainerNodes(t,i){var s=this._ifcNodesMap.get(i);if(void 0===s)console.assert(!1,"Tried to create a container for nodes of a non-existent GenericType");else for(let e=0;e<s.size;e+=this._maxNodeChildrenSize){var r=e+this._maxNodeChildrenSize>s.size?s.size-1:e+this._maxNodeChildrenSize-1,r=`Child nodes ${e} - `+r,o=e/this._maxNodeChildrenSize,n=a.UUID.create(),r=(this._tree.addChild(r,h.getContainerId(n),t,"container",!0,l.Desktop.Tree.Types),new d(i,o));this._containerMap.set(n,r)}}_selectIfcComponent(e,t){this._viewer.selectionManager.selectType(e,t)}_onNewModel(){return __awaiter(this,void 0,void 0,function*(){var e=this._viewer.model;this._tree.clear(),this._ifcNodesMap=e.getGenericTypeIdMap(),this._ifcNodesMap.forEach((e,t)=>{var i=h.getGenericTypeId(t);this._tree.appendTopLevelElement(t,i,"assembly",!0,!1)}),0===this._ifcNodesMap.size?this.hideTab():this.showTab()})}static getComponentPartId(e){return"typespart"+l.ViewTree.separator+e}static getGenericTypeId(e){return"types"+l.ViewTree.separator+e}static getContainerId(e){return"container"+l.ModelTree.separator+e}}l.TypesTree=h}}(Communicator=Communicator||{});